<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ÄÏïîÎèô Í±¥Ï∂ï Ï†êÍ≤Ä Î≥¥Í≥†ÏÑú - Firebase + LocalStorage ÌïòÏù¥Î∏åÎ¶¨Îìú</title>
    
    <!-- Firebase v11.6.0 ÏµúÏã† Modular SDK -->
    <script type="module">
        // Firebase v11.6.0 Modular API Î∂àÎü¨Ïò§Í∏∞
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-storage.js';
        import { getFirestore, collection, addDoc, doc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp, getDocs } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js';
        
        // Firebase ÏÑ§Ï†ï (Ïã§Ï†ú ÌîÑÎ°úÏ†ùÌä∏ Ïó∞Í≤∞Îê®)
        const firebaseConfig = {
            apiKey: "AIzaSyACCbVD7LT2istfACwJhthp7dYWbTutgz4",
            authDomain: "personal-564df.firebaseapp.com",
            projectId: "personal-564df",
            storageBucket: "personal-564df.firebasestorage.app",
            messagingSenderId: "1016556488732",
            appId: "1:1016556488732:web:06bf11f1be63a4242d77d9",
            
            // Firebase ÌôúÏÑ±Ìôî
            disabled: false // Ïã§Ï†ú Firebase ÌîÑÎ°úÏ†ùÌä∏ Ïó∞Í≤∞Îê®
        };

        // Firebase Ï¥àÍ∏∞Ìôî (Ï°∞Í±¥Î∂Ä)
        let firebaseEnabled = false;
        
        if (!firebaseConfig.disabled && firebaseConfig.apiKey !== "AIzaSyDQGQGQGQGQGQGQGQGQGQGQGQGQGQGQG") {
            try {
                const app = initializeApp(firebaseConfig);
                const storage = getStorage(app);
                const firestore = getFirestore(app);

                // Ï†ÑÏó≠ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎèÑÎ°ù ÏÑ§Ï†ï
                window.firebaseStorage = storage;
                window.firebaseFirestore = firestore;
                window.firebaseModules = {
                    ref, uploadBytes, getDownloadURL, deleteObject,
                    collection, addDoc, doc, deleteDoc, serverTimestamp,
                    getDocs, query, orderBy
                };
                
                firebaseEnabled = true;
                console.log("üî• Firebase v11.6.0 Ï¥àÍ∏∞Ìôî ÏôÑÎ£å (ÌïòÏù¥Î∏åÎ¶¨Îìú Î™®Îìú)");
            } catch (error) {
                console.warn("‚ö†Ô∏è Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®, Î°úÏª¨ Ï†ÑÏö© Î™®ÎìúÎ°ú Ï†ÑÌôò:", error.message);
                firebaseEnabled = false;
            }
        } else {
            console.log("üì± Î°úÏª¨ Ï†ÑÏö© Î™®Îìú (Firebase ÎπÑÌôúÏÑ±Ìôî)");
            firebaseEnabled = false;
        }
        
        // Firebase ÏÉÅÌÉúÎ•º Ï†ÑÏó≠Ïóê Ï†ÄÏû•
        window.firebaseEnabled = firebaseEnabled;
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .landlord-section .section-title {
            background: linear-gradient(135deg, #3742fa, #2f3542);
        }
        
        .tenant-section .section-title {
            background: linear-gradient(135deg, #5f27cd, #341f97);
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .stars {
            font-size: 18px;
            color: #ffd700;
        }
        
        .image-gallery {
            margin-bottom: 15px;
        }
        
        .image-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
        }
        
        .btn-success:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .local-only-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 193, 7, 0.9);
            color: #856404;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            z-index: 10;
            border: 1px solid #ffc107;
        }
        
        .firebase-synced-icon {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(40, 167, 69, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            z-index: 10;
            border: 1px solid #28a745;
        }
        
        .version-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: #ff4444;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-family: monospace;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 2px solid #fff;
        }
        
        .hidden {
            display: none !important;
        }
        
        .carousel-container {
            position: relative;
            width: 100%;
            max-height: 200px;
            overflow: hidden;
            border-radius: 6px;
            background: #f8f9fa;
            display: none;
        }
        
        .carousel-track {
            display: flex;
            transition: transform 0.3s ease;
        }
        
        .carousel-slide {
            min-width: 100%;
            position: relative;
        }
        
        .carousel-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: none;
        }
        
        .carousel-nav.prev {
            left: 10px;
        }
        
        .carousel-nav.next {
            right: 10px;
        }
        
        .carousel-container:hover .carousel-nav {
            display: block;
        }
        
        .image-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(220, 53, 69, 0.8);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }
        
        .image-counter {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .card-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .summary {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .data-controls {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .data-controls h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .data-controls .btn {
            margin: 5px;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        /* Lightbox Ïä§ÌÉÄÏùº */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            cursor: pointer;
        }
        
        .lightbox.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            cursor: default;
        }
        
        .lightbox-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 90vw;
            max-height: 90vh;
        }
        
        .lightbox-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox-close:hover {
            background: white;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox-nav:hover {
            background: white;
        }
        
        .lightbox-nav.prev {
            left: -60px;
        }
        
        .lightbox-nav.next {
            right: -60px;
        }
        
        .lightbox-info {
            position: absolute;
            bottom: -40px;
            left: 0;
            right: 0;
            color: white;
            text-align: center;
            font-size: 14px;
        }
        
        .carousel-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .carousel-image:hover {
            transform: scale(1.02);
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .image-controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Î∂ÄÏïîÎèô Í±¥Ï∂ï Ï†êÍ≤Ä Î≥¥Í≥†ÏÑú</h1>
        
        <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ Ïª®Ìä∏Î°§ -->
        <div class="data-controls">
            <h3>üì± Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ (ÌïòÏù¥Î∏åÎ¶¨Îìú Î™®Îìú)</h3>
            <div style="margin-bottom: 15px;">
                <div id="firebase-status" style="padding: 8px; border-radius: 4px; background: #e8f5e8; color: #2d5016; font-weight: bold;">
                    üîÑ Firebase Ïó∞Í≤∞ Ï§ë...
                </div>
            </div>
            <button class="btn btn-secondary" onclick="exportData()">üíæ Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ</button>
            <button class="btn btn-primary" onclick="importData()">üì• Îç∞Ïù¥ÌÑ∞ Î≥µÏõê</button>
            <button class="btn btn-success" onclick="uploadLocalDataToFirebase()" id="upload-local-btn">‚òÅÔ∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¥ÎùºÏö∞Îìú ÏóÖÎ°úÎìú</button>
            <button class="btn btn-warning" onclick="cleanupDuplicates()" id="cleanup-duplicates-btn">üßπ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨</button>
            <button class="btn btn-warning" onclick="cleanupDuplicates()">üßπ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨</button>
            <button class="btn btn-info" onclick="debugImageData()">üîç Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú ÌôïÏù∏</button>
            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú</button>
            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                * ÏÇ¨ÏßÑÏùÄ Î∏åÎùºÏö∞Ï†Ä(LocalStorage) + Firebase StorageÏóê Ïù¥Ï§ë Ï†ÄÏû•Îê©ÎãàÎã§.<br>
                * Ïò§ÌîÑÎùºÏù∏ÏóêÏÑúÎèÑ ÏûëÎèôÌïòÎ©∞, Ïò®ÎùºÏù∏Ïãú ÏûêÎèôÏúºÎ°ú ÌÅ¥ÎùºÏö∞Îìú Î∞±ÏóÖÎê©ÎãàÎã§.
            </div>
        </div>
        
        <!-- ÏûÑÎåÄÏù∏ ÌòëÏùòÏÇ¨Ìï≠ -->
        <div class="section landlord-section">
            <div class="section-title">üè† ÏûÑÎåÄÏù∏ ÌòëÏùòÏÇ¨Ìï≠ (13Í∞ú Ìï≠Î™©)</div>
            
            <div class="cards-grid">
                <!-- Î≥ÑÌëú 5Í∞ú: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê -->
                <div class="card" data-card-id="landlord-1">
                    <div class="card-header">
                        <div class="card-number">1</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-1" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-1')">
                        <input type="file" id="cameraInput-landlord-1" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-1')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-1').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-1').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-1">
                            <div class="carousel-track" id="carousel-landlord-1"></div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-1')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-1')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-1">0/0</div>
                        </div>
                    </div>
                    <div class="card-title">Í±¥Î¨ºÏô∏Î≤Ω Í≥∞Ìå°Ïù¥ Ï≤≠ÏÜå</div>
                    <div class="card-description">Í±¥Î¨º Ïô∏Î≤ΩÏóê Î∞úÏÉùÌïú Í≥∞Ìå°Ïù¥Î°ú Ïù∏Ìïú Í±¥Í∞ï Î∞è Íµ¨Ï°∞Ï†Å ÏúÑÌóò</div>
                </div>
                
                <div class="card" data-card-id="landlord-2">
                    <div class="card-header">
                        <div class="card-number">2</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-2" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-2')">
                        <input type="file" id="cameraInput-landlord-2" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-2')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-2').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-2').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-2">
                            <div class="carousel-track" id="carousel-landlord-2">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-2')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-2')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-2">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">Í≥ÑÎã® ÎÇúÍ∞Ñ ÏÜêÏû°Ïù¥ ÏÑ§Ïπò</div>
                    <div class="card-description">Í≥ÑÎã® ÏïàÏ†ÑÏùÑ ÏúÑÌïú ÎÇúÍ∞Ñ ÏÜêÏû°Ïù¥ Î≥¥Ïàò Î∞è ÏÑ§Ïπò</div>
                </div>
                
                <div class="card" data-card-id="landlord-3">
                    <div class="card-header">
                        <div class="card-number">3</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-3" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-3')">
                        <input type="file" id="cameraInput-landlord-3" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-3')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-3').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-3').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-3">
                            <div class="carousel-track" id="carousel-landlord-3">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-3')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-3')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-3">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">2Ï∏µ ÌôîÏû•Ïã§ Ï≤úÏû• ÎàÑÏàò</div>
                    <div class="card-description">2Ï∏µ ÌôîÏû•Ïã§ Ï≤úÏû• ÎàÑÏàò ÌôïÏù∏ Î∞è Î∞©Ïàò Î≥¥Ïàò</div>
                </div>
                
                <div class="card" data-card-id="landlord-4">
                    <div class="card-header">
                        <div class="card-number">4</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-4" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-4')">
                        <input type="file" id="cameraInput-landlord-4" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-4')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-4').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-4').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-4">
                            <div class="carousel-track" id="carousel-landlord-4">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-4')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-4')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-4">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">1Ï∏µ Î∞îÎã• Î≥¥Ïàò</div>
                    <div class="card-description">1Ï∏µ Î∞îÎã•Ïùò Ïã¨Í∞ÅÌïú ÌååÏÜê Î∂ÄÎ∂Ñ Í∏¥Í∏â Î≥¥Ïàò</div>
                </div>
                
                <div class="card" data-card-id="landlord-5">
                    <div class="card-header">
                        <div class="card-number">5</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-5" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-5')">
                        <input type="file" id="cameraInput-landlord-5" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-5')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-5').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-5').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-5">
                            <div class="carousel-track" id="carousel-landlord-5">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-5')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-5')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-5">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">2Ï∏µ Î∞îÎã• Î≥¥Ïàò</div>
                    <div class="card-description">2Ï∏µ Î∞îÎã• Í∑†Ïó¥ Î∞è ÏÜêÏÉÅ Î∂ÄÎ∂Ñ Î≥¥Ïàò</div>
                </div>
                
                <!-- Î≥ÑÌëú 4Í∞ú: ‚≠ê‚≠ê‚≠ê‚≠ê -->
                <div class="card" data-card-id="landlord-6">
                    <div class="card-header">
                        <div class="card-number">6</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-6" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-6')">
                        <input type="file" id="cameraInput-landlord-6" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-6')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-6').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-6').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-6">
                            <div class="carousel-track" id="carousel-landlord-6">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-6')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-6')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-6">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">4Ï∏µ ÌôîÏû•Ïã§ Î∞îÎã• ÎàÑÏàò</div>
                    <div class="card-description">4Ï∏µ ÌôîÏû•Ïã§ Î∞îÎã• ÎàÑÏàò ÌôïÏù∏ Î∞è Î≥¥Ïàò</div>
                </div>
                
                <div class="card" data-card-id="landlord-7">
                    <div class="card-header">
                        <div class="card-number">7</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-7" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-7')">
                        <input type="file" id="cameraInput-landlord-7" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-7')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-7').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-7').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-7">
                            <div class="carousel-track" id="carousel-landlord-7"></div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-7')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-7')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-7">0/0</div>
                        </div>
                    </div>
                    <div class="card-title">Ï°∞Í≤Ω Ï†ïÎ¶¨</div>
                    <div class="card-description">Í±¥Î¨º Ï£ºÎ≥Ä Ï°∞Í≤Ω Ï†ïÎ¶¨ Î∞è ÌôòÍ≤Ω Í∞úÏÑ† ÏûëÏóÖ</div>
                </div>
                
                <!-- Î≥ÑÌëú 3Í∞ú: ‚≠ê‚≠ê‚≠ê -->
                <div class="card" data-card-id="landlord-8">
                    <div class="card-header">
                        <div class="card-number">8</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-8" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-8')">
                        <input type="file" id="cameraInput-landlord-8" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-8')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-8').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-8').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-8">
                            <div class="carousel-track" id="carousel-landlord-8">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-8')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-8')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-8">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥ Ïú†Í≤©1</div>
                    <div class="card-description">2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥Ïùò Ïú†Í≤© Ï°∞Ï†ï Î∞è Î≥¥Ïàò</div>
                </div>
                
                <div class="card" data-card-id="landlord-9">
                    <div class="card-header">
                        <div class="card-number">9</div>
                        <div class="stars">‚≠ê‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-9" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-9')">
                        <input type="file" id="cameraInput-landlord-9" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-9')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-9').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-9').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-9">
                            <div class="carousel-track" id="carousel-landlord-9">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-9')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-9')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-9">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥ Ïú†Í≤©2</div>
                    <div class="card-description">2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥Ïùò Ï∂îÍ∞Ä Ïú†Í≤© Î¨∏Ï†ú Ìï¥Í≤∞</div>
                </div>
                
                <!-- Î≥ÑÌëú 2Í∞ú: ‚≠ê‚≠ê -->
                <div class="card" data-card-id="landlord-10">
                    <div class="card-header">
                        <div class="card-number">10</div>
                        <div class="stars">‚≠ê‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-10" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-10')">
                        <input type="file" id="cameraInput-landlord-10" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-10')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-10').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-10').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-10">
                            <div class="carousel-track" id="carousel-landlord-10"></div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-10')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-10')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-10">0/0</div>
                        </div>
                    </div>
                    <div class="card-title">Í±¥Î¨º Ïô∏Î∂Ä Ï°∞Î™Ö Ï†êÍ≤Ä</div>
                    <div class="card-description">Í±¥Î¨º Ïô∏Î∂Ä Ï°∞Î™Ö ÏãúÏÑ§ Ï†êÍ≤Ä Î∞è ÍµêÏ≤¥</div>
                </div>
                
                <!-- Î≥ÑÌëú 1Í∞ú: ‚≠ê -->
                <div class="card" data-card-id="landlord-11">
                    <div class="card-header">
                        <div class="card-number">11</div>
                        <div class="stars">‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-11" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-11')">
                        <input type="file" id="cameraInput-landlord-11" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-11')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-11').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-11').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-11">
                            <div class="carousel-track" id="carousel-landlord-11">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-11')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-11')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-11">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">Ïä§ÏúÑÏπò Ï†êÍ≤Ä</div>
                    <div class="card-description">Ï†ÑÍ∏∞ Ïä§ÏúÑÏπò ÏûëÎèô ÏÉÅÌÉú Ï†êÍ≤Ä Î∞è ÍµêÏ≤¥</div>
                </div>
                
                <div class="card" data-card-id="landlord-12">
                    <div class="card-header">
                        <div class="card-number">12</div>
                        <div class="stars">‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-12" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-12')">
                        <input type="file" id="cameraInput-landlord-12" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-12')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-12').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-12').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-12">
                            <div class="carousel-track" id="carousel-landlord-12">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-12')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-12')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-12">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">ÌÜµÏã†Ìï® Ïª§Î≤Ñ</div>
                    <div class="card-description">ÌÜµÏã†Ìï® Ïª§Î≤Ñ Î≥¥Ïàò Î∞è ÍµêÏ≤¥</div>
                </div>
                
                <div class="card" data-card-id="landlord-13">
                    <div class="card-header">
                        <div class="card-number">13</div>
                        <div class="stars">‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-landlord-13" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'landlord-13')">
                        <input type="file" id="cameraInput-landlord-13" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'landlord-13')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-landlord-13').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-landlord-13').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-landlord-13">
                            <div class="carousel-track" id="carousel-landlord-13">
                            </div>
                            <button class="carousel-nav prev" onclick="prevImage('landlord-13')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('landlord-13')">‚Ä∫</button>
                            <div class="image-counter" id="counter-landlord-13">1/1</div>
                        </div>
                    </div>
                    <div class="card-title">Í≥ÑÎã® ÏÜêÏû°Ïù¥ Î≥¥Ïàò</div>
                    <div class="card-description">Í∏∞Ï°¥ Í≥ÑÎã® ÏÜêÏû°Ïù¥ Î∂ÄÏãù ÌôïÏù∏ Î∞è Î≥¥Ïàò</div>
                </div>
            </div>
        </div>
        
        <!-- Ï†ÑÏûÑÏ∞®Ïù∏ ÌòëÏùòÏÇ¨Ìï≠ -->
        <div class="section tenant-section">
            <div class="section-title">üë§ Ï†ÑÏûÑÏ∞®Ïù∏ ÌòëÏùòÏÇ¨Ìï≠ (1Í∞ú Ìï≠Î™©)</div>
            
            <div class="cards-grid">
                <div class="card" data-card-id="tenant-1">
                    <div class="card-header">
                        <div class="card-number">1</div>
                        <div class="stars">‚≠ê</div>
                    </div>
                    <div class="image-gallery">
                        <input type="file" id="fileInput-tenant-1" class="hidden" accept="image/*" multiple onchange="handleFileUpload(event, 'tenant-1')">
                        <input type="file" id="cameraInput-tenant-1" class="hidden" accept="image/*" capture="environment" onchange="handleFileUpload(event, 'tenant-1')">
                        <div class="image-controls">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput-tenant-1').click()">üì∑ ÏÇ¨ÏßÑ Ï∂îÍ∞Ä</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('cameraInput-tenant-1').click()">üì∏ Ïπ¥Î©îÎùº</button>
                        </div>
                        <div class="carousel-container" id="container-tenant-1">
                            <div class="carousel-track" id="carousel-tenant-1"></div>
                            <button class="carousel-nav prev" onclick="prevImage('tenant-1')">‚Äπ</button>
                            <button class="carousel-nav next" onclick="nextImage('tenant-1')">‚Ä∫</button>
                            <div class="image-counter" id="counter-tenant-1">0/0</div>
                        </div>
                    </div>
                    <div class="card-title">Ïπ¥Ìéò Î∞îÌÖåÏù¥Î∏î Ï≤òÎ¶¨</div>
                    <div class="card-description">Ï†ÑÏûÑÏ∞®Ïù∏Ïù¥ ÏÑ§ÏπòÌïú Ïπ¥Ìéò Î∞îÌÖåÏù¥Î∏î Ï≤†Í±∞ Ï°∞Í±¥ ÌòëÏùò</div>
                </div>
            </div>
        </div>
        
        <div class="summary">
            <h2>üìã Ï†êÍ≤Ä ÏöîÏïΩ</h2>
            <p>Ï¥ù 14Í∞ú Ìï≠Î™© | ÏûÑÎåÄÏù∏ ÌòëÏùò 13Í∞ú | Ï†ÑÏûÑÏ∞®Ïù∏ ÌòëÏùò 1Í∞ú</p>
            <p><strong>Î≥ÑÌëúÎ≥Ñ Î∂ÑÎ•ò:</strong> ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê(5Í∞ú) > ‚≠ê‚≠ê‚≠ê‚≠ê(2Í∞ú) > ‚≠ê‚≠ê‚≠ê(2Í∞ú) > ‚≠ê‚≠ê(1Í∞ú) > ‚≠ê(4Í∞ú)</p>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content" onclick="event.stopPropagation()">
            <button class="lightbox-close" onclick="closeLightbox()">√ó</button>
            <button class="lightbox-nav prev" onclick="prevLightboxImage()">‚Äπ</button>
            <button class="lightbox-nav next" onclick="nextLightboxImage()">‚Ä∫</button>
            <img class="lightbox-image" id="lightbox-image" src="" alt="">
            <div class="lightbox-info" id="lightbox-info"></div>
        </div>
    </div>

    <script>
        // Ïù¥ÎØ∏ÏßÄ Í¥ÄÎ¶¨ Í∞ùÏ≤¥ - localStorageÏôÄ ÎèôÍ∏∞Ìôî
        let imageData = {};
        
        // LocalStorage ÌÇ§
        const STORAGE_KEY = 'jinbu-image-data';
        
        // Lightbox Í¥ÄÎ†® Î≥ÄÏàò
        let currentLightboxCardId = null;
        let currentLightboxIndex = 0;
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
        function loadDataFromStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    imageData = JSON.parse(stored);
                    console.log('Îç∞Ïù¥ÌÑ∞ Î≥µÏõêÎê®:', imageData);
                    
                    // ÌååÏùºÎ™Ö ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò (Ïòõ ÌååÏùºÎ™Ö ‚Üí ÏÉà ÌååÏùºÎ™Ö)
                    let needsUpdate = false;
                    Object.keys(imageData).forEach(cardId => {
                        if (imageData[cardId]) {
                            imageData[cardId].forEach(img => {
                                if (img.src) {
                                    const oldSrc = img.src;
                                    // ÌååÏùºÎ™Ö Î≥ÄÍ≤Ω Îß§Ìïë
                                    img.src = img.src.replace('01_Ïä§ÏúÑÏπò.jpg', '01_switch.jpg');
                                    img.src = img.src.replace('02_ÌÜµÏã†Ìï®Ïª§Î≤Ñ.jpg', '02_communication.jpg');
                                    
                                    if (oldSrc !== img.src) {
                                        console.log('ÌååÏùºÎ™Ö ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò:', oldSrc, '‚Üí', img.src);
                                        needsUpdate = true;
                                    }
                                }
                            });
                        }
                    });
                    
                    // ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÏù¥ Î∞úÏÉùÌñàÏúºÎ©¥ Ï†ÄÏû•
                    if (needsUpdate) {
                        saveDataToStorage();
                        console.log('ÌååÏùºÎ™Ö ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏôÑÎ£å');
                    }
                    
                    // Î™®Îì† Ïπ¥ÎìúÏùò Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
                    Object.keys(imageData).forEach(cardId => {
                        updateCarousel(cardId);
                    });
                }
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Ïã§Ìå®:', error);
                imageData = {};
            }
        }
        
        // FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ (Ï§ëÎ≥µ Î∞©ÏßÄ Í∞ïÌôî)
        async function loadDataFromFirebase() {
            if (!window.firebaseFirestore) {
                console.log('FirebaseÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏïÑ Í±¥ÎÑàÎúÄ');
                return false;
            }
            
            try {
                const { collection, getDocs, query, orderBy } = window.firebaseModules;
                const firestore = window.firebaseFirestore;
                
                console.log('üî• FirebaseÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...');
                updateFirebaseStatus('üì• FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Îäî Ï§ë...');
                
                // FirestoreÏóêÏÑú Î™®Îì† Ïù¥ÎØ∏ÏßÄ Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const imagesCollection = collection(firestore, 'images');
                const q = query(imagesCollection, orderBy('uploadTime', 'asc'));
                const querySnapshot = await getDocs(q);
                
                const firebaseData = {};
                let imageCount = 0;
                const processedUrls = new Set(); // Ï§ëÎ≥µ Î∞©ÏßÄÏö© URL Ï∂îÏ†Å
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const cardId = data.cardId;
                    const firebaseUrl = data.url;
                    
                    // Ïù¥ÎØ∏ Ï≤òÎ¶¨Îêú URLÏù∏ÏßÄ ÌôïÏù∏ (Firebase Î†àÎ≤®ÏóêÏÑú Ï§ëÎ≥µ Î∞©ÏßÄ)
                    if (processedUrls.has(firebaseUrl)) {
                        console.log(`Firebase Ï§ëÎ≥µ URL Í±¥ÎÑàÎúÄ: ${firebaseUrl}`);
                        return;
                    }
                    processedUrls.add(firebaseUrl);
                    
                    if (!firebaseData[cardId]) {
                        firebaseData[cardId] = [];
                    }
                    
                    const imageInfo = {
                        src: firebaseUrl, // Firebase Storage URL ÏÇ¨Ïö©
                        firebaseUrl: firebaseUrl,
                        firebaseId: data.fileName,
                        docId: doc.id,
                        name: data.originalName || data.fileName,
                        timestamp: data.uploadTime?.toDate?.()?.toISOString() || new Date().toISOString(),
                        isLocal: false // FirebaseÏóêÏÑú Ïò® Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
                    };
                    
                    firebaseData[cardId].push(imageInfo);
                    imageCount++;
                });
                
                if (imageCount > 0) {
                    console.log(`üî• FirebaseÏóêÏÑú ${imageCount}Í∞ú Í≥†Ïú† Ïù¥ÎØ∏ÏßÄ Î∂àÎü¨Ïò¥:`, firebaseData);
                    
                    // Í∏∞Ï°¥ LocalStorage Îç∞Ïù¥ÌÑ∞ÏôÄ Î≥ëÌï© (ÏôÑÏ†ÑÌïú Ï§ëÎ≥µ Ï†úÍ±∞)
                    const currentLocalCount = Object.values(imageData).reduce((total, arr) => total + arr.length, 0);
                    
                    if (currentLocalCount === 0) {
                        // LocalStorageÍ∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ Firebase Îç∞Ïù¥ÌÑ∞Î°ú ÎåÄÏ≤¥
                        imageData = { ...firebaseData };
                        console.log('LocalStorageÍ∞Ä ÎπÑÏñ¥ÏûàÏñ¥ Firebase Îç∞Ïù¥ÌÑ∞Î°ú ÍµêÏ≤¥');
                    } else {
                        // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ÏôÄ Î≥ëÌï© (ÏôÑÏ†ÑÌïú Ï§ëÎ≥µ Ï≤¥ÌÅ¨)
                        Object.keys(firebaseData).forEach(cardId => {
                            if (!imageData[cardId]) {
                                imageData[cardId] = [];
                            }
                            
                            // Firebase Ïù¥ÎØ∏ÏßÄÍ∞Ä LocalStorageÏóê ÏóÜÏúºÎ©¥ Ï∂îÍ∞Ä (ÏôÑÏ†ÑÌïú Ï§ëÎ≥µ Ï≤¥ÌÅ¨)
                            firebaseData[cardId].forEach(firebaseImage => {
                                const exists = imageData[cardId].some(localImage => {
                                    // ÏôÑÏ†ÑÌïú Ï§ëÎ≥µ Ï≤¥ÌÅ¨ (Îã§Ï§ë Í∏∞Ï§Ä)
                                    return (
                                        // Firebase URLÎ°ú Ï≤¥ÌÅ¨
                                        localImage.firebaseUrl === firebaseImage.firebaseUrl ||
                                        localImage.src === firebaseImage.firebaseUrl ||
                                        // Firebase IDÎ°ú Ï≤¥ÌÅ¨
                                        (localImage.firebaseId && localImage.firebaseId === firebaseImage.firebaseId) ||
                                        // ÌååÏùºÎ™Ö + URL Ï°∞Ìï©ÏúºÎ°ú Ï≤¥ÌÅ¨
                                        (localImage.name === firebaseImage.name && localImage.src === firebaseImage.src) ||
                                        // docIdÎ°ú Ï≤¥ÌÅ¨ (Firestore Î¨∏ÏÑú ID)
                                        (localImage.docId && localImage.docId === firebaseImage.docId)
                                    );
                                });
                                
                                if (!exists) {
                                    imageData[cardId].push(firebaseImage);
                                    console.log(`‚úÖ Firebase Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä: ${cardId} - ${firebaseImage.name}`);
                                } else {
                                    console.log(`üö´ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Í±¥ÎÑàÎúÄ: ${cardId} - ${firebaseImage.name}`);
                                }
                            });
                        });
                        
                        // Ï∂îÍ∞Ä Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨ (ÏïàÏ†ÑÏû•Ïπò)
                        const removedCount = removeDuplicateImages();
                    }
                    
                    // LocalStorageÏóê Ï†ÄÏû•
                    saveDataToStorage();
                    
                    // UI ÏóÖÎç∞Ïù¥Ìä∏
                    Object.keys(imageData).forEach(cardId => {
                        updateCarousel(cardId);
                    });
                    
                    updateFirebaseStatus(`‚úÖ FirebaseÏóêÏÑú ${imageCount}Í∞ú Ïù¥ÎØ∏ÏßÄ Î∂àÎü¨Ïò¥`);
                    return true;
                } else {
                    console.log('FirebaseÏóê Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏùå');
                    updateFirebaseStatus('‚ÑπÔ∏è FirebaseÏóê Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå');
                    return false;
                }
                
            } catch (error) {
                console.error('Firebase Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', error);
                updateFirebaseStatus('‚ùå Firebase Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®', true);
                return false;
            }
        }
        
        // Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨ Ìï®Ïàò (Í∞ïÌôîÎêú Î≤ÑÏ†Ñ)
        function removeDuplicateImages() {
            let removedCount = 0;
            
            Object.keys(imageData).forEach(cardId => {
                if (!imageData[cardId] || imageData[cardId].length <= 1) return;
                
                const uniqueImages = [];
                const seenIds = new Set();
                const seenUrls = new Set();
                const seenHashes = new Set();
                const seenDocIds = new Set();
                
                imageData[cardId].forEach((image, index) => {
                    // Í≥†Ïú†ÏÑ± Ï≤¥ÌÅ¨ Í∏∞Ï§ÄÎì§ (ÏôÑÏ†ÑÌïú Ï§ëÎ≥µ Î∞©ÏßÄ)
                    const firebaseIdCheck = image.firebaseId && seenIds.has(image.firebaseId);
                    const firebaseUrlCheck = image.firebaseUrl && seenUrls.has(image.firebaseUrl);
                    const srcUrlCheck = image.src && seenUrls.has(image.src);
                    const docIdCheck = image.docId && seenDocIds.has(image.docId);
                    const hashCheck = seenHashes.has(image.src + '|' + image.name + '|' + (image.timestamp || ''));
                    
                    const isDuplicate = firebaseIdCheck || firebaseUrlCheck || srcUrlCheck || docIdCheck || hashCheck;
                    
                    if (!isDuplicate) {
                        uniqueImages.push(image);
                        if (image.firebaseId) seenIds.add(image.firebaseId);
                        if (image.firebaseUrl) seenUrls.add(image.firebaseUrl);
                        if (image.src) seenUrls.add(image.src);
                        if (image.docId) seenDocIds.add(image.docId);
                        seenHashes.add(image.src + '|' + image.name + '|' + (image.timestamp || ''));
                    } else {
                        removedCount++;
                        console.log(`üßπ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞: ${cardId}[${index}] - ${image.name}`);
                        console.log(`  ‚îú‚îÄ FirebaseId: ${image.firebaseId}, URL: ${image.firebaseUrl}`);
                        console.log(`  ‚îî‚îÄ Ï§ëÎ≥µ ÏõêÏù∏: ${firebaseIdCheck ? 'IDÏ§ëÎ≥µ ' : ''}${firebaseUrlCheck ? 'URLÏ§ëÎ≥µ ' : ''}${docIdCheck ? 'DocIDÏ§ëÎ≥µ ' : ''}${hashCheck ? 'HashÏ§ëÎ≥µ' : ''}`);
                    }
                });
                
                if (uniqueImages.length !== imageData[cardId].length) {
                    imageData[cardId] = uniqueImages;
                    console.log(`‚úÖ ${cardId}: ${imageData[cardId].length}Í∞ú ‚Üí ${uniqueImages.length}Í∞ú (${imageData[cardId].length - uniqueImages.length}Í∞ú Ï†úÍ±∞)`);
                }
            });
            
            if (removedCount > 0) {
                console.log(`üßπ Ï¥ù ${removedCount}Í∞ú Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨ ÏôÑÎ£å`);
                updateFirebaseStatus(`üßπ ${removedCount}Í∞ú Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨Îê®`);
                return removedCount;
            }
            
            return 0;
        }
        
        // ÏàòÎèô Ï§ëÎ≥µ Ï†ïÎ¶¨ Ïã§Ìñâ
        function cleanupDuplicates() {
            const confirmed = confirm('Ï§ëÎ≥µÎêú Ïù¥ÎØ∏ÏßÄÎì§ÏùÑ Ï†ïÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÎèôÏùºÌïú Ïù¥ÎØ∏ÏßÄÍ∞Ä Ïó¨Îü¨ Í∞ú ÏûàÎäî Í≤ΩÏö∞ ÌïòÎÇòÎßå ÎÇ®Í∏∞Í≥† ÎÇòÎ®∏ÏßÄÎäî Ï†úÍ±∞Îê©ÎãàÎã§.');
            
            if (confirmed) {
                updateFirebaseStatus('üßπ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄ Ï†ïÎ¶¨ Ï§ë...');
                
                const removedCount = removeDuplicateImages();
                
                if (removedCount > 0) {
                    // LocalStorage ÏóÖÎç∞Ïù¥Ìä∏
                    saveDataToStorage();
                    
                    // UI ÏÉàÎ°úÍ≥†Ïπ®
                    Object.keys(imageData).forEach(cardId => {
                        updateCarousel(cardId);
                    });
                    
                    updateFirebaseStatus(`‚úÖ ${removedCount}Í∞ú Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ïÎ¶¨ÎêòÏóàÏäµÎãàÎã§!`);
                    alert(`${removedCount}Í∞úÏùò Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†ïÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`);
                } else {
                    updateFirebaseStatus('‚úÖ Ï§ëÎ≥µ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§');
                    alert('Ï§ëÎ≥µÎêú Ïù¥ÎØ∏ÏßÄÍ∞Ä Î∞úÍ≤¨ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                }
            }
        }
        
        // Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú ÎîîÎ≤ÑÍπÖ
        function debugImageData() {
            console.log('=== Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ ÏÉÅÌÉú ÎîîÎ≤ÑÍπÖ ===');
            
            let totalImages = 0;
            let duplicateCount = 0;
            let firebaseImages = 0;
            let localOnlyImages = 0;
            const analysis = {};
            
            Object.keys(imageData).forEach(cardId => {
                const images = imageData[cardId] || [];
                const cardAnalysis = {
                    count: images.length,
                    firebase: 0,
                    localOnly: 0,
                    duplicates: [],
                    firebaseIds: [],
                    firebaseUrls: [],
                    names: []
                };
                
                const seenIds = new Set();
                const seenUrls = new Set();
                const seenNames = new Set();
                
                images.forEach((image, index) => {
                    totalImages++;
                    
                    // Firebase ÏÉÅÌÉú Ï≤¥ÌÅ¨
                    if (image.firebaseId && image.firebaseUrl) {
                        firebaseImages++;
                        cardAnalysis.firebase++;
                    } else {
                        localOnlyImages++;
                        cardAnalysis.localOnly++;
                    }
                    
                    // Ï§ëÎ≥µ Ï≤¥ÌÅ¨
                    if (image.firebaseId) {
                        if (seenIds.has(image.firebaseId)) {
                            duplicateCount++;
                            cardAnalysis.duplicates.push(`${index}: ID Ï§ëÎ≥µ - ${image.firebaseId}`);
                        }
                        seenIds.add(image.firebaseId);
                        cardAnalysis.firebaseIds.push(image.firebaseId);
                    }
                    
                    if (image.firebaseUrl) {
                        if (seenUrls.has(image.firebaseUrl)) {
                            duplicateCount++;
                            cardAnalysis.duplicates.push(`${index}: URL Ï§ëÎ≥µ - ${image.firebaseUrl}`);
                        }
                        seenUrls.add(image.firebaseUrl);
                        cardAnalysis.firebaseUrls.push(image.firebaseUrl);
                    }
                    
                    if (image.name) {
                        if (seenNames.has(image.name)) {
                            cardAnalysis.duplicates.push(`${index}: Ïù¥Î¶Ñ Ï§ëÎ≥µ - ${image.name}`);
                        }
                        seenNames.add(image.name);
                        cardAnalysis.names.push(image.name);
                    }
                });
                
                analysis[cardId] = cardAnalysis;
            });
            
            // ÏΩòÏÜîÏóê ÏÉÅÏÑ∏ Î¶¨Ìè¨Ìä∏ Ï∂úÎ†•
            console.log(`Ï¥ù Ïù¥ÎØ∏ÏßÄ: ${totalImages}Í∞ú`);
            console.log(`Firebase ÎèôÍ∏∞Ìôî: ${firebaseImages}Í∞ú`);
            console.log(`Î°úÏª¨ Ï†ÑÏö©: ${localOnlyImages}Í∞ú`);
            console.log(`Ï§ëÎ≥µ Í∞êÏßÄ: ${duplicateCount}Í∞ú`);
            console.log('Ïπ¥ÎìúÎ≥Ñ ÏÉÅÏÑ∏ Î∂ÑÏÑù:', analysis);
            
            // Ï§ëÎ≥µÏù¥ ÏûàÎäî Ïπ¥ÎìúÎßå Î≥ÑÎèÑ Ï∂úÎ†•
            Object.keys(analysis).forEach(cardId => {
                const card = analysis[cardId];
                if (card.duplicates.length > 0) {
                    console.warn(`‚ö†Ô∏è ${cardId} Ïπ¥ÎìúÏóêÏÑú Ï§ëÎ≥µ Î∞úÍ≤¨:`, card.duplicates);
                }
                if (card.count > 1) {
                    console.log(`üìä ${cardId}: ${card.count}Í∞ú Ïù¥ÎØ∏ÏßÄ (Firebase: ${card.firebase}, Î°úÏª¨: ${card.localOnly})`);
                }
            });
            
            // ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
            const message = `ÎîîÎ≤ÑÍπÖ ÏôÑÎ£å!\n\nÏ¥ù Ïù¥ÎØ∏ÏßÄ: ${totalImages}Í∞ú\nFirebase ÎèôÍ∏∞Ìôî: ${firebaseImages}Í∞ú\nÎ°úÏª¨ Ï†ÑÏö©: ${localOnlyImages}Í∞ú\nÏ§ëÎ≥µ Í∞êÏßÄ: ${duplicateCount}Í∞ú\n\nÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÄ Console(F12)ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.`;
            
            alert(message);
            
            updateFirebaseStatus(`üîç ÎîîÎ≤ÑÍπÖ ÏôÑÎ£å: Ï¥ù ${totalImages}Í∞ú Ïù¥ÎØ∏ÏßÄ, ${duplicateCount}Í∞ú Ï§ëÎ≥µ Í∞êÏßÄ`);
        }
        
        // LocalStorage Ïö©Îüâ Ï≤¥ÌÅ¨ Ìï®Ïàò
        function checkStorageQuota() {
            try {
                const testKey = 'storage-test';
                const testData = new Array(1024 * 1024).join('a'); // 1MB ÌÖåÏä§Ìä∏
                localStorage.setItem(testKey, testData);
                localStorage.removeItem(testKey);
                return true;
            } catch (e) {
                return false;
            }
        }

        // Îç∞Ïù¥ÌÑ∞Î•º localStorageÏóê Ï†ÄÏû• (Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ)
        function saveDataToStorage() {
            try {
                // ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞ Í≥ÑÏÇ∞
                const dataString = JSON.stringify(imageData);
                const sizeInMB = (dataString.length / 1024 / 1024).toFixed(2);
                console.log(`Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞: ${sizeInMB}MB`);
                
                // 5MB Ïù¥ÏÉÅÏù¥Î©¥ Í≤ΩÍ≥†
                if (sizeInMB > 5) {
                    console.warn('‚ö†Ô∏è Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞Í∞Ä 5MBÎ•º Ï¥àÍ≥ºÌñàÏäµÎãàÎã§. ÏùºÎ∂Ä Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ≠Ï†úÌïòÎäî Í≤ÉÏùÑ Í∂åÏû•Ìï©ÎãàÎã§.');
                    updateFirebaseStatus(`‚ö†Ô∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¨Í∏∞: ${sizeInMB}MB (Í∂åÏû•: 5MB Ïù¥Ìïò)`, true);
                }
                
                localStorage.setItem(STORAGE_KEY, dataString);
                console.log('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Îê®');
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®:', error);
                
                if (error.name === 'QuotaExceededError') {
                    // Ïö©Îüâ Ï¥àÍ≥ºÏãú ÏÇ¨Ïö©ÏûêÏóêÍ≤å ÏïåÎ¶º
                    alert('üíæ Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!\n\nÌï¥Í≤∞ Î∞©Î≤ï:\n1. ÏùºÎ∂Ä Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ≠Ï†úÌïòÏÑ∏Ïöî\n2. Î∏åÎùºÏö∞Ï†Ä Ï∫êÏãúÎ•º Ï†ïÎ¶¨ÌïòÏÑ∏Ïöî\n3. Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ ÌõÑ "Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú"Î•º Ïã§ÌñâÌïòÏÑ∏Ïöî');
                    updateFirebaseStatus('‚ùå LocalStorage Ïö©Îüâ Ï¥àÍ≥º - Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú ÌïÑÏöî', true);
                    
                    // Ïö©Îüâ Ï¥àÍ≥ºÏãú ÎßàÏßÄÎßâ Ï∂îÍ∞ÄÎêú Ïù¥ÎØ∏ÏßÄÎì§ Ï†úÍ±∞ ÏãúÎèÑ
                    if (confirm('ÏûêÎèôÏúºÎ°ú ÏµúÍ∑º Ï∂îÍ∞ÄÎêú Ïù¥ÎØ∏ÏßÄÎì§ÏùÑ Ï†úÍ±∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        autoCleanupImages();
                    }
                } else {
                    updateFirebaseStatus('‚ùå Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®', true);
                    alert('Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä Ï†ÄÏû• Í≥µÍ∞ÑÏù¥ Î∂ÄÏ°±Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
                }
            }
        }

        // ÏûêÎèô Ï†ïÎ¶¨ Ìï®Ïàò
        function autoCleanupImages() {
            try {
                let cleaned = false;
                
                // Í∞Å Ïπ¥ÎìúÏóêÏÑú Í∞ÄÏû• ÏµúÍ∑º Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞
                for (const cardId in imageData) {
                    if (imageData[cardId] && imageData[cardId].length > 1) {
                        imageData[cardId].pop(); // ÎßàÏßÄÎßâ Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞
                        updateCarousel(cardId);
                        cleaned = true;
                    }
                }
                
                if (cleaned) {
                    saveDataToStorage(); // Ïû¨ÏãúÎèÑ
                    alert('ÏùºÎ∂Ä Ïù¥ÎØ∏ÏßÄÍ∞Ä Ï†úÍ±∞ÎêòÏóàÏäµÎãàÎã§.');
                } else {
                    alert('Ï†úÍ±∞Ìï† Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§. ÏàòÎèôÏúºÎ°ú Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ≠Ï†úÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            } catch (error) {
                console.error('ÏûêÎèô Ï†ïÎ¶¨ Ïã§Ìå®:', error);
            }
        }

        // ÌååÏùº ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        // Firebase ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function updateFirebaseStatus(status, isError = false) {
            const statusElement = document.getElementById('firebase-status');
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.style.background = isError ? '#ffe8e8' : '#e8f5e8';
                statusElement.style.color = isError ? '#d63031' : '#2d5016';
            }
        }

        // Firebase StorageÏóê Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
        async function uploadToFirebase(file, cardId) {
            try {
                const { ref, uploadBytes, getDownloadURL, collection, addDoc, serverTimestamp } = window.firebaseModules;
                const storage = window.firebaseStorage;
                const firestore = window.firebaseFirestore;
                
                // ÌååÏùºÎ™Ö ÏÉùÏÑ± (Í≥†Ïú†ÏÑ±ÏùÑ ÏúÑÌï¥ timestamp Ï∂îÍ∞Ä)
                const timestamp = new Date().getTime();
                const fileName = `${cardId}_${timestamp}_${file.name}`;
                const storageRef = ref(storage, `jinbu-images/${fileName}`);
                
                // Firebase StorageÏóê ÏóÖÎ°úÎìú
                console.log('Firebase ÏóÖÎ°úÎìú ÏãúÏûë:', fileName);
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                // FirestoreÏóê Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                const imageDoc = {
                    cardId: cardId,
                    fileName: file.name,
                    originalFileName: file.name,
                    storageFileName: fileName,
                    downloadURL: downloadURL,
                    uploadedAt: serverTimestamp(),
                    fileSize: file.size,
                    fileType: file.type
                };
                
                const docRef = await addDoc(collection(firestore, 'jinbu-images'), imageDoc);
                console.log('Firebase ÏóÖÎ°úÎìú ÏôÑÎ£å:', downloadURL);
                
                return {
                    firebaseUrl: downloadURL,
                    firebaseId: fileName,
                    docId: docRef.id
                };
                
            } catch (error) {
                console.error('Firebase ÏóÖÎ°úÎìú Ïã§Ìå®:', error);
                updateFirebaseStatus('‚ùå Firebase ÏóÖÎ°úÎìú Ïã§Ìå®: ' + error.message, true);
                return null;
            }
        }

        // Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï Ìï®Ïàò (LocalStorage Ïö©Îüâ ÏµúÏ†ÅÌôî)
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // ÎπÑÏú® Ïú†ÏßÄÌïòÎ©∞ Î¶¨ÏÇ¨Ïù¥Ï¶à
                    const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                    canvas.width = img.width * ratio;
                    canvas.height = img.height * ratio;
                    
                    // Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // ÏïïÏ∂ïÎêú Îç∞Ïù¥ÌÑ∞ URL Î∞òÌôò
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    console.log(`Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï: ${file.name} (ÏõêÎ≥∏: ${(file.size/1024).toFixed(1)}KB ‚Üí ÏïïÏ∂ï: ${(compressedDataUrl.length*0.75/1024).toFixed(1)}KB)`);
                    resolve(compressedDataUrl);
                };
                
                const reader = new FileReader();
                reader.onload = (e) => img.src = e.target.result;
                reader.readAsDataURL(file);
            });
        }

        function handleFileUpload(event, cardId) {
            console.log('handleFileUpload called for:', cardId);
            const files = Array.from(event.target.files);
            console.log('Files selected:', files.length);
            
            files.forEach(async (file) => {
                console.log('Processing file:', file.name);
                
                // 1. Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï (LocalStorage Ïö©Îüâ ÏµúÏ†ÅÌôî)
                const compressedSrc = await compressImage(file);
                
                // 2. Ï¶âÏãú Î°úÏª¨Ïóê Ï∂îÍ∞Ä (Îπ†Î•∏ ÏùëÎãµ)
                console.log('File compressed, adding to carousel');
                const localImageData = {
                    src: compressedSrc, // ÏïïÏ∂ïÎêú Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö©
                    name: file.name,
                    timestamp: new Date().toISOString(),
                    isLocal: true,
                    firebaseUrl: null,
                    firebaseId: null,
                    docId: null
                };
                addImageToCarousel(cardId, localImageData);
                
                // 2. FirebaseÏóê Î∞±Í∑∏ÎùºÏö¥Îìú ÏóÖÎ°úÎìú (ÌôúÏÑ±ÌôîÎêòÏñ¥ ÏûàÏùÑ ÎïåÎßå)
                if (window.firebaseEnabled) {
                    try {
                        updateFirebaseStatus('üîÑ Firebase ÏóÖÎ°úÎìú Ï§ë...');
                        const firebaseData = await uploadToFirebase(file, cardId);
                        
                        if (firebaseData && imageData[cardId]) {
                            // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Ïóê Firebase Ï†ïÎ≥¥ Ï∂îÍ∞Ä
                            const localImages = imageData[cardId];
                            const targetImage = localImages.find(img => 
                                img.name === file.name && img.isLocal && !img.firebaseUrl
                            );
                            
                            if (targetImage) {
                                targetImage.firebaseUrl = firebaseData.firebaseUrl;
                                targetImage.firebaseId = firebaseData.firebaseId;
                                targetImage.docId = firebaseData.docId;
                                targetImage.isLocal = false; // Ïù¥Ï†ú FirebaseÏóêÎèÑ Ï†ÄÏû•Îê®
                                console.log('Firebase Îç∞Ïù¥ÌÑ∞ Ïó∞Í≤∞ ÏôÑÎ£å:', targetImage);
                            }
                            
                            saveDataToStorage(); // LocalStorage ÏóÖÎç∞Ïù¥Ìä∏
                            updateFirebaseStatus('‚úÖ Firebase ÎèôÍ∏∞Ìôî ÏôÑÎ£å');
                        } else {
                            updateFirebaseStatus('‚ö†Ô∏è Firebase ÏóÖÎ°úÎìú Ïã§Ìå® (Î°úÏª¨ Ï†ÄÏû•ÏùÄ ÏôÑÎ£å)', true);
                        }
                    } catch (firebaseError) {
                        console.error('Firebase ÏóÖÎ°úÎìú Ïã§Ìå®:', firebaseError);
                        
                        // Firebase Ïã§Ìå® ÏõêÏù∏Î≥Ñ Î©îÏãúÏßÄ
                        let errorMessage = '‚ö†Ô∏è Firebase ÏóÖÎ°úÎìú Ïã§Ìå®: ';
                        if (firebaseError.code === 'storage/unauthorized') {
                            errorMessage += 'Í∂åÌïú ÏóÜÏùå (Î°úÏª¨ Ï†ÄÏû•ÏùÄ ÏôÑÎ£å)';
                        } else if (firebaseError.code === 'storage/quota-exceeded') {
                            errorMessage += 'Ïö©Îüâ Ï¥àÍ≥º (Î°úÏª¨ Ï†ÄÏû•ÏùÄ ÏôÑÎ£å)';
                        } else {
                            errorMessage += 'ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò (Î°úÏª¨ Ï†ÄÏû•ÏùÄ ÏôÑÎ£å)';
                        }
                        
                        updateFirebaseStatus(errorMessage, true);
                        console.log('üîÑ Î°úÏª¨ Ï†ÄÏû•ÏùÄ Ï†ïÏÉÅ ÏûëÎèô Ï§ë (Ïò§ÌîÑÎùºÏù∏ Î™®Îìú)');
                    }
                } else {
                    updateFirebaseStatus('üì± Î°úÏª¨ Ï†ÑÏö© Î™®Îìú (Firebase ÎπÑÌôúÏÑ±Ìôî)', false);
                    console.log('üì± Î°úÏª¨ Ï†ÑÏö©ÏúºÎ°ú Ï†ÄÏû• ÏôÑÎ£å');
                }
            });
            
            // ÌååÏùº ÏûÖÎ†• Ï¥àÍ∏∞Ìôî
            event.target.value = '';
        }

        // Ïπ¥Îü¨ÏÖÄÏóê Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä (ÏàòÏ†ïÎêú Î≤ÑÏ†Ñ)
        function addImageToCarousel(cardId, newImageData) {
            if (!imageData[cardId]) {
                imageData[cardId] = [];
            }
            
            imageData[cardId].push(newImageData);
            
            updateCarousel(cardId);
            saveDataToStorage(); // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        }

        // Ïπ¥Îü¨ÏÖÄ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCarousel(cardId) {
            const carousel = document.getElementById(`carousel-${cardId}`);
            const container = document.getElementById(`container-${cardId}`);
            const images = imageData[cardId] || [];
            
            if (!carousel || !container) {
                console.error('Carousel elements not found for:', cardId);
                return;
            }
            
            carousel.innerHTML = '';
            
            images.forEach((image, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                
                // ÎèôÍ∏∞Ìôî ÏÉÅÌÉú ÌôïÏù∏
                const syncStatus = getImageSyncStatus(image);
                const statusIcon = syncStatus === 'firebase' 
                    ? '<div class="firebase-synced-icon">‚òÅÔ∏è ÎèôÍ∏∞Îê®</div>'
                    : '<div class="local-only-icon">üíæ Î°úÏª¨Îßå</div>';
                
                slide.innerHTML = `
                    <img src="${image.src}" alt="${image.name}" class="carousel-image" onclick="openLightbox('${cardId}', ${index})" title="ÌÅ¥Î¶≠ÌïòÏó¨ ÏõêÎ≥∏ Î≥¥Í∏∞">
                    ${statusIcon}
                    <button class="image-delete" onclick="deleteImage('${cardId}', ${index})" title="ÏÇ≠Ï†ú">√ó</button>
                `;
                carousel.appendChild(slide);
            });
            
            // Ïª®ÌÖåÏù¥ÎÑà ÌëúÏãú
            if (images.length > 0) {
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
            
            updateImageCounter(cardId);
        }

        // Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
        // FirebaseÏóêÏÑú Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
        async function deleteFromFirebase(imageInfo) {
            try {
                if (!imageInfo.firebaseId || !imageInfo.docId) {
                    console.log('Firebase Ï†ïÎ≥¥Í∞Ä ÏóÜÏñ¥ Î°úÏª¨ÏóêÏÑúÎßå ÏÇ≠Ï†ú');
                    return true;
                }
                
                const { ref, deleteObject, doc, deleteDoc } = window.firebaseModules;
                const storage = window.firebaseStorage;
                const firestore = window.firebaseFirestore;
                
                // Firebase StorageÏóêÏÑú ÏÇ≠Ï†ú
                const storageRef = ref(storage, `jinbu-images/${imageInfo.firebaseId}`);
                await deleteObject(storageRef);
                console.log('Firebase Storage ÏÇ≠Ï†ú ÏôÑÎ£å:', imageInfo.firebaseId);
                
                // FirestoreÏóêÏÑú ÏÇ≠Ï†ú
                await deleteDoc(doc(firestore, 'jinbu-images', imageInfo.docId));
                console.log('Firestore Î¨∏ÏÑú ÏÇ≠Ï†ú ÏôÑÎ£å:', imageInfo.docId);
                
                return true;
            } catch (error) {
                console.error('Firebase ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                updateFirebaseStatus('‚ö†Ô∏è Firebase ÏÇ≠Ï†ú Ïã§Ìå® (Î°úÏª¨ÏóêÏÑúÎäî ÏÇ≠Ï†úÎê®)', true);
                return false;
            }
        }

        async function deleteImage(cardId, index) {
            if (imageData[cardId] && imageData[cardId][index]) {
                const imageInfo = imageData[cardId][index];
                const confirmDelete = confirm('Ïù¥ ÏÇ¨ÏßÑÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Î°úÏª¨ + FirebaseÏóêÏÑú Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§)');
                
                if (confirmDelete) {
                    // 1. FirebaseÏóêÏÑú ÏÇ≠Ï†ú ÏãúÎèÑ
                    updateFirebaseStatus('üîÑ Firebase ÏÇ≠Ï†ú Ï§ë...');
                    await deleteFromFirebase(imageInfo);
                    
                    // 2. Î°úÏª¨ÏóêÏÑú ÏÇ≠Ï†ú
                    imageData[cardId].splice(index, 1);
                    updateCarousel(cardId);
                    saveDataToStorage(); // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    
                    updateFirebaseStatus('‚úÖ ÏÇ≠Ï†ú ÏôÑÎ£å');
                }
            }
        }

        // Ïù¥Ï†Ñ Ïù¥ÎØ∏ÏßÄ
        function prevImage(cardId) {
            const carousel = document.getElementById(`carousel-${cardId}`);
            const images = imageData[cardId] || [];
            if (images.length <= 1) return;
            
            if (!carousel.dataset.currentIndex) {
                carousel.dataset.currentIndex = '0';
            }
            
            let currentIndex = parseInt(carousel.dataset.currentIndex);
            currentIndex = currentIndex > 0 ? currentIndex - 1 : images.length - 1;
            carousel.dataset.currentIndex = currentIndex.toString();
            
            carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
            updateImageCounter(cardId);
        }

        // Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
        function nextImage(cardId) {
            const carousel = document.getElementById(`carousel-${cardId}`);
            const images = imageData[cardId] || [];
            if (images.length <= 1) return;
            
            if (!carousel.dataset.currentIndex) {
                carousel.dataset.currentIndex = '0';
            }
            
            let currentIndex = parseInt(carousel.dataset.currentIndex);
            currentIndex = currentIndex < images.length - 1 ? currentIndex + 1 : 0;
            carousel.dataset.currentIndex = currentIndex.toString();
            
            carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
            updateImageCounter(cardId);
        }

        // Ïù¥ÎØ∏ÏßÄ Ïπ¥Ïö¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateImageCounter(cardId) {
            const counter = document.getElementById(`counter-${cardId}`);
            const carousel = document.getElementById(`carousel-${cardId}`);
            const images = imageData[cardId] || [];
            
            if (!counter || !carousel) return;
            
            if (images.length > 0) {
                const currentIndex = parseInt(carousel.dataset.currentIndex || '0') + 1;
                counter.textContent = `${currentIndex}/${images.length}`;
                counter.style.display = 'block';
            } else {
                counter.textContent = '0/0';
                counter.style.display = 'none';
            }
        }
        
        // Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ (JSON ÌååÏùºÎ°ú Îã§Ïö¥Î°úÎìú)
        function exportData() {
            try {
                const dataStr = JSON.stringify(imageData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `jinbu-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                alert('Îç∞Ïù¥ÌÑ∞Í∞Ä Î∞±ÏóÖÎêòÏóàÏäµÎãàÎã§.');
            } catch (error) {
                console.error('Î∞±ÏóÖ Ïã§Ìå®:', error);
                alert('Î∞±ÏóÖÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
            }
        }
        
        // Îç∞Ïù¥ÌÑ∞ Î≥µÏõê Î≤ÑÌäº ÌÅ¥Î¶≠
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        const confirmImport = confirm('Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞Î•º Î™®Îëê ÍµêÏ≤¥ÌïòÏãúÍ≤†ÏäµÎãàÍπå?');
                        if (confirmImport) {
                            imageData = importedData;
                            saveDataToStorage();
                            location.reload(); // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÅÏö©
                        }
                    } catch (error) {
                        console.error('Î≥µÏõê Ïã§Ìå®:', error);
                        alert('ÏûòÎ™ªÎêú Î∞±ÏóÖ ÌååÏùºÏûÖÎãàÎã§.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // Î™®Îì† Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
        function clearAllData() {
            const confirmClear = confirm('Î™®Îì† ÏÇ¨ÏßÑÍ≥º Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(Î°úÏª¨ Ï†ÄÏû•ÏÜåÎßå ÏÇ≠Ï†úÎê©ÎãàÎã§. Firebase Îç∞Ïù¥ÌÑ∞Îäî ÏàòÎèôÏúºÎ°ú ÏÇ≠Ï†úÌï¥Ï£ºÏÑ∏Ïöî)\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.');
            if (confirmClear) {
                const doubleConfirm = confirm('Ï†ïÎßêÎ°ú Î™®Îì† Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');
                if (doubleConfirm) {
                    imageData = {};
                    saveDataToStorage();
                    updateFirebaseStatus('‚ö†Ô∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Îßå ÏÇ≠Ï†úÎê® (Firebase Îç∞Ïù¥ÌÑ∞Îäî Ïú†ÏßÄ)', true);
                    location.reload();
                }
            }
        }
        
        // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Î•º FirebaseÏóê ÏóÖÎ°úÎìú
        async function uploadLocalDataToFirebase() {
            if (!window.firebaseStorage || !window.firebaseFirestore) {
                alert('FirebaseÍ∞Ä Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§. ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            const uploadBtn = document.getElementById('upload-local-btn');
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'üîÑ ÏóÖÎ°úÎìú Ï§ë...';
            
            let uploadCount = 0;
            let totalTargetImages = 0;
            let failedImages = 0;
            
            // ÏóÖÎ°úÎìú ÎåÄÏÉÅ Ïù¥ÎØ∏ÏßÄ Î∂ÑÎ•ò
            const imagesToUpload = [];
            
            for (const cardId in imageData) {
                for (let i = 0; i < imageData[cardId].length; i++) {
                    const image = imageData[cardId][i];
                    
                    // 1ÏàúÏúÑ: firebaseIdÍ∞Ä ÏóÜÎäî ÏôÑÏ†ÑÌïú Î°úÏª¨ Ï†ÑÏö© Ïù¥ÎØ∏ÏßÄ
                    if (!image.firebaseId) {
                        imagesToUpload.push({cardId, index: i, image, reason: 'no-firebase-id'});
                    }
                    // 2ÏàúÏúÑ: firebaseIdÎäî ÏûàÏßÄÎßå firebaseUrlÏù¥ ÏóÜÎäî ÏóÖÎ°úÎìú Ïã§Ìå® Ïù¥ÎØ∏ÏßÄ
                    else if (image.firebaseId && !image.firebaseUrl) {
                        imagesToUpload.push({cardId, index: i, image, reason: 'upload-failed'});
                    }
                    // 3ÏàúÏúÑ: Firebase URLÏù¥ ÏûàÏßÄÎßå Ïã§Ï†ú Ï†ëÍ∑º Î∂àÍ∞ÄÎä•Ìï† Ïàò ÏûàÎäî Ïù¥ÎØ∏ÏßÄ (ÏÑ†ÌÉùÏ†Å)
                    else if (image.firebaseUrl && image.src && image.src.startsWith('data:')) {
                        imagesToUpload.push({cardId, index: i, image, reason: 'url-check-needed'});
                    }
                }
            }
            
            totalTargetImages = imagesToUpload.length;
            
            if (totalTargetImages === 0) {
                // Í∞ïÏ†ú Ïû¨ÏóÖÎ°úÎìú ÏòµÏÖò Ï†úÍ≥µ
                const forceReupload = confirm('ÏóÖÎ°úÎìúÌï† Î°úÏª¨ Ï†ÑÏö© Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎ™®Îì† Ïù¥ÎØ∏ÏßÄÎ•º Í∞ïÏ†úÎ°ú Îã§Ïãú ÏóÖÎ°úÎìúÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n(ÎÑ§Ìä∏ÏõåÌÅ¨ Î¨∏Ï†úÎ°ú ÎèôÍ∏∞ÌôîÍ∞Ä Ïïà Îêú Í≤ΩÏö∞Ïóê Ïú†Ïö©Ìï©ÎãàÎã§)');
                
                if (forceReupload) {
                    // Î™®Îì† Ïù¥ÎØ∏ÏßÄÎ•º Í∞ïÏ†ú Ïû¨ÏóÖÎ°úÎìú ÎåÄÏÉÅÏóê Ï∂îÍ∞Ä
                    for (const cardId in imageData) {
                        for (let i = 0; i < imageData[cardId].length; i++) {
                            const image = imageData[cardId][i];
                            if (image.src) {
                                imagesToUpload.push({cardId, index: i, image, reason: 'force-reupload'});
                            }
                        }
                    }
                    totalTargetImages = imagesToUpload.length;
                    
                    if (totalTargetImages === 0) {
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = '‚òÅÔ∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¥ÎùºÏö∞Îìú ÏóÖÎ°úÎìú';
                        return;
                    }
                } else {
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = '‚òÅÔ∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¥ÎùºÏö∞Îìú ÏóÖÎ°úÎìú';
                    return;
                }
            }
            
            updateFirebaseStatus(`üì§ ${totalTargetImages}Í∞ú Ïù¥ÎØ∏ÏßÄÎ•º FirebaseÏóê ÏóÖÎ°úÎìú Ï§ë...`);
            
            try {
                for (const {cardId, index, image, reason} of imagesToUpload) {
                    try {
                        console.log(`ÏóÖÎ°úÎìú ÏãúÎèÑ: ${cardId}-${index} (${reason})`);
                        
                        // base64Î•º BlobÏúºÎ°ú Î≥ÄÌôò
                        const response = await fetch(image.src);
                        const blob = await response.blob();
                        
                        // Firebase StorageÏóê ÏóÖÎ°úÎìú
                        const { ref, uploadBytes, getDownloadURL, collection, addDoc, serverTimestamp } = window.firebaseModules;
                        const storage = window.firebaseStorage;
                        const firestore = window.firebaseFirestore;
                        
                        const fileName = `${cardId}-${Date.now()}-${index}.jpg`;
                        const storageRef = ref(storage, `images/${fileName}`);
                        
                        await uploadBytes(storageRef, blob);
                        const downloadURL = await getDownloadURL(storageRef);
                        
                        // FirestoreÏóê Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                        const docRef = await addDoc(collection(firestore, 'images'), {
                            cardId: cardId,
                            fileName: fileName,
                            url: downloadURL,
                            uploadTime: serverTimestamp(),
                            originalName: image.name || fileName,
                            uploadReason: reason
                        });
                        
                        // Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                        imageData[cardId][index].firebaseId = fileName;
                        imageData[cardId][index].docId = docRef.id;
                        imageData[cardId][index].firebaseUrl = downloadURL;
                        
                        uploadCount++;
                        updateFirebaseStatus(`üì§ ÏóÖÎ°úÎìú ÏßÑÌñâ Ï§ë... (${uploadCount}/${totalTargetImages})`);
                        
                        console.log(`ÏóÖÎ°úÎìú ÏÑ±Í≥µ: ${cardId}-${index}`);
                        
                    } catch (error) {
                        console.error(`Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïã§Ìå® (${cardId}-${index}):`, error);
                        failedImages++;
                    }
                }
                
                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                saveDataToStorage();
                
                // UI ÏÉàÎ°úÍ≥†Ïπ®
                displayImages();
                
                if (failedImages === 0) {
                    updateFirebaseStatus(`‚úÖ ${uploadCount}Í∞ú Ïù¥ÎØ∏ÏßÄÍ∞Ä FirebaseÏóê ÏóÖÎ°úÎìúÎêòÏóàÏäµÎãàÎã§!`);
                } else {
                    updateFirebaseStatus(`‚ö†Ô∏è ${uploadCount}Í∞ú ÏÑ±Í≥µ, ${failedImages}Í∞ú Ïã§Ìå®`);
                }
                
            } catch (error) {
                console.error('ÏóÖÎ°úÎìú ÌîÑÎ°úÏÑ∏Ïä§ Ïò§Î•ò:', error);
                updateFirebaseStatus('‚ùå ÏóÖÎ°úÎìú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§', true);
            }
            
            uploadBtn.disabled = false;
            uploadBtn.textContent = '‚òÅÔ∏è Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÌÅ¥ÎùºÏö∞Îìú ÏóÖÎ°úÎìú';
        }
        
        // Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî ÏÉÅÌÉú ÌôïÏù∏
        function getImageSyncStatus(image) {
            if (image.firebaseId && image.firebaseUrl) {
                return 'firebase';
            } else {
                return 'local';
            }
        }
        
        // Î™®Îì† Ïπ¥ÎìúÏùò Ïù¥ÎØ∏ÏßÄ Îã§Ïãú ÌëúÏãú
        function displayImages() {
            Object.keys(imageData).forEach(cardId => {
                updateCarousel(cardId);
            });
        }
        
        // Lightbox Ïó¥Í∏∞
        function openLightbox(cardId, imageIndex) {
            const images = imageData[cardId] || [];
            if (images.length === 0) return;
            
            currentLightboxCardId = cardId;
            currentLightboxIndex = imageIndex;
            
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxInfo = document.getElementById('lightbox-info');
            
            // Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ï
            const image = images[imageIndex];
            lightboxImage.src = image.src;
            lightboxImage.alt = image.name;
            
            // Ï†ïÎ≥¥ ÏÑ§Ï†ï
            lightboxInfo.textContent = `${image.name} (${imageIndex + 1}/${images.length})`;
            
            // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÌëúÏãú/Ïà®ÍπÄ
            const prevBtn = lightbox.querySelector('.lightbox-nav.prev');
            const nextBtn = lightbox.querySelector('.lightbox-nav.next');
            
            if (images.length > 1) {
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
            } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            }
            
            // Lightbox ÌëúÏãú
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden'; // Ïä§ÌÅ¨Î°§ Î∞©ÏßÄ
        }
        
        // Lightbox Îã´Í∏∞
        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = ''; // Ïä§ÌÅ¨Î°§ Î≥µÏõê
            currentLightboxCardId = null;
            currentLightboxIndex = 0;
        }
        
        // Lightbox Ïù¥Ï†Ñ Ïù¥ÎØ∏ÏßÄ
        function prevLightboxImage() {
            if (!currentLightboxCardId) return;
            
            const images = imageData[currentLightboxCardId] || [];
            if (images.length <= 1) return;
            
            currentLightboxIndex = currentLightboxIndex > 0 ? currentLightboxIndex - 1 : images.length - 1;
            
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxInfo = document.getElementById('lightbox-info');
            const image = images[currentLightboxIndex];
            
            lightboxImage.src = image.src;
            lightboxImage.alt = image.name;
            lightboxInfo.textContent = `${image.name} (${currentLightboxIndex + 1}/${images.length})`;
        }
        
        // Lightbox Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
        function nextLightboxImage() {
            if (!currentLightboxCardId) return;
            
            const images = imageData[currentLightboxCardId] || [];
            if (images.length <= 1) return;
            
            currentLightboxIndex = currentLightboxIndex < images.length - 1 ? currentLightboxIndex + 1 : 0;
            
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxInfo = document.getElementById('lightbox-info');
            const image = images[currentLightboxIndex];
            
            lightboxImage.src = image.src;
            lightboxImage.alt = image.name;
            lightboxInfo.textContent = `${image.name} (${currentLightboxIndex + 1}/${images.length})`;
        }
        
        // ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        document.addEventListener('keydown', function(e) {
            const lightbox = document.getElementById('lightbox');
            if (!lightbox.classList.contains('active')) return;
            
            if (e.key === 'Escape') {
                closeLightbox();
            } else if (e.key === 'ArrowLeft') {
                prevLightboxImage();
            } else if (e.key === 'ArrowRight') {
                nextLightboxImage();
            }
        });

        // Ï¥àÍ∏∞Ìôî - Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄÎì§ÏùÑ imageDataÏóê Îì±Î°ùÌïòÍ≥† localStorageÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
        // Ï¥àÍ∏∞ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ (ÌïòÎìúÏΩîÎî© ÎåÄÏã† ÎèôÏ†Å Ï¥àÍ∏∞Ìôî)
        const initialImageData = {
            'landlord-2': [{ src: 'images/17_Í≥ÑÎã®ÎÇúÍ∞ÑÏÜêÏû°Ïù¥ÏÑ§Ïπò2.jpg', name: 'Í≥ÑÎã® ÎÇúÍ∞Ñ ÏÜêÏû°Ïù¥', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-3': [{ src: 'images/09_2Ï∏µÏ∞ΩÍ≥†ÎàÑÏàòÌôïÏù∏.jpg', name: '2Ï∏µ ÌôîÏû•Ïã§ Ï≤úÏû• ÎàÑÏàò', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-4': [{ src: 'images/03_Î∞îÎã•1.jpg', name: '1Ï∏µ Î∞îÎã• Î≥¥Ïàò', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-5': [{ src: 'images/04_Î∞îÎã•2.jpg', name: '2Ï∏µ Î∞îÎã• Î≥¥Ïàò', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-6': [{ src: 'images/16_4Ï∏µÌôîÏû•Ïã§Î∞îÎã•ÎàÑÏàòÌôïÏù∏.jpg', name: '4Ï∏µ ÌôîÏû•Ïã§ Î∞îÎã• ÎàÑÏàò', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-8': [{ src: 'images/12_2Ï∏µÌè¥Îî©ÎèÑÏñ¥Ïú†Í≤©1.jpg', name: '2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥ Ïú†Í≤©1', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-9': [{ src: 'images/13_2Ï∏µÌè¥Îî©ÎèÑÏñ¥Ïú†Í≤©2.jpg', name: '2Ï∏µ Ìè¥Îî©ÎèÑÏñ¥ Ïú†Í≤©2', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-11': [{ src: 'images/01_switch.jpg', name: 'Ïä§ÏúÑÏπò Ï†êÍ≤Ä', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-12': [{ src: 'images/02_communication.jpg', name: 'ÌÜµÏã†Ìï® Ïª§Î≤Ñ', timestamp: '2025-05-29T13:52:00.000Z' }],
            'landlord-13': [{ src: 'images/05_Í≥ÑÎã®ÏÜêÏû°Ïù¥.jpg', name: 'Í≥ÑÎã® ÏÜêÏû°Ïù¥ Î≥¥Ïàò', timestamp: '2025-05-29T13:52:00.000Z' }]
        };

        // Ï¥àÍ∏∞ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Î°úÎìú (Îπà localStorageÏùº ÎïåÎßå)
        function loadInitialImages() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored || Object.keys(JSON.parse(stored || '{}')).length === 0) {
                console.log('LocalStorageÍ∞Ä ÎπÑÏñ¥ÏûàÏùå. Ï¥àÍ∏∞ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
                imageData = { ...initialImageData };
                saveDataToStorage();
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                Object.keys(imageData).forEach(cardId => {
                    updateCarousel(cardId);
                });
                console.log('Ï¥àÍ∏∞ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏôÑÎ£å');
            }
        }

        // ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî (Ï§ëÎ≥µ Î∞©ÏßÄ Í∞ïÌôî)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî ÏãúÏûë (Ï§ëÎ≥µ Î∞©ÏßÄ Î™®Îìú)');
            
            // Firebase ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            if (window.firebaseEnabled) {
                updateFirebaseStatus('‚úÖ Firebase v11.6.0 Ïó∞Í≤∞Îê® (ÌïòÏù¥Î∏åÎ¶¨Îìú Î™®Îìú)');
            } else {
                updateFirebaseStatus('üì± Î°úÏª¨ Ï†ÑÏö© Î™®Îìú (Firebase ÎπÑÌôúÏÑ±Ìôî)');
            }
            
            // Îç∞Ïù¥ÌÑ∞ Î°úÎî© ÌîåÎûòÍ∑∏
            let isDataLoaded = false;
            
            // 1Îã®Í≥Ñ: Î®ºÏ†Ä localStorageÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î≥µÏõê
            console.log('üìÇ 1Îã®Í≥Ñ: LocalStorageÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
            loadDataFromStorage();
            const localImageCount = Object.values(imageData).reduce((total, arr) => total + arr.length, 0);
            console.log(`üìÇ LocalStorageÏóêÏÑú ${localImageCount}Í∞ú Ïù¥ÎØ∏ÏßÄ Î°úÎìúÎê®`);
            
            // 2Îã®Í≥Ñ: FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞ ÏãúÎèÑ (Ï§ëÎ≥µ Î∞©ÏßÄ)
            if (window.firebaseFirestore) {
                console.log('‚òÅÔ∏è 2Îã®Í≥Ñ: FirebaseÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÎèôÍ∏∞Ìôî');
                loadDataFromFirebase().then((hasFirebaseData) => {
                    const finalImageCount = Object.values(imageData).reduce((total, arr) => total + arr.length, 0);
                    console.log(`‚òÅÔ∏è Firebase ÎèôÍ∏∞Ìôî ÏôÑÎ£å: ÏµúÏ¢Ö ${finalImageCount}Í∞ú Ïù¥ÎØ∏ÏßÄ`);
                    
                    // Firebase Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÍ≥† LocalStorageÎèÑ ÎπÑÏñ¥ÏûàÏúºÎ©¥ Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                    if (!hasFirebaseData && localImageCount === 0 && !isDataLoaded) {
                        console.log('üéØ Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìñâ');
                        loadInitialImages();
                        saveDataToStorage();
                        isDataLoaded = true;
                    }
                }).catch(error => {
                    console.error('Firebase Î°úÎî© Ïã§Ìå®:', error);
                    
                    // Firebase Ïã§Ìå®Ïãú LocalStorageÍ∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                    if (localImageCount === 0 && !isDataLoaded) {
                        console.log('üéØ Firebase Ïã§Ìå® ‚Üí Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
                        loadInitialImages();
                        saveDataToStorage();
                        isDataLoaded = true;
                    }
                });
            } else {
                // FirebaseÍ∞Ä ÏóÜÏúºÎ©¥ localStorageÍ∞Ä ÎπÑÏñ¥ÏûàÏùÑ ÎïåÎßå Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                if (localImageCount === 0 && !isDataLoaded) {
                    console.log('üéØ Firebase ÏóÜÏùå ‚Üí Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú');
                    loadInitialImages();
                    saveDataToStorage();
                    isDataLoaded = true;
                }
            }
            
            console.log('üéâ ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        });
        
        // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• (ÏïàÏ†ÑÏû•Ïπò)
        window.addEventListener('beforeunload', function() {
            saveDataToStorage();
        });
    </script>
    
    <!-- Î≤ÑÏ†Ñ Ï†ïÎ≥¥ -->
    <div class="version-info">
        üö´ v2.5.0 - Ï§ëÎ≥µ Î∞©ÏßÄ ÏãúÏä§ÌÖú Í∞ïÌôî üö´
    </div>
</body>
</html>/* Cache bust Fri May 30 23:29:58 KST 2025 */
