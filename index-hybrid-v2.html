<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶€ì•”ë™ ê±´ì¶• ì ê²€ ë³´ê³ ì„œ - ì €ì¥ ìƒíƒœ í‘œì‹œ</title>
    
    <!-- Firebase v11.6.0 ìµœì‹  Modular SDK -->
    <script type="module">
        // Firebase v11.6.0 Modular API ë¶ˆëŸ¬ì˜¤ê¸°
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-storage.js';
        import { getFirestore, collection, addDoc, doc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp, getDocs } from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js';
        
        // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ ì—°ê²°ë¨)
        const firebaseConfig = {
            apiKey: "AIzaSyACCbVD7LT2istfACwJhthp7dYWbTutgz4",
            authDomain: "personal-564df.firebaseapp.com",
            projectId: "personal-564df",
            storageBucket: "personal-564df.firebasestorage.app",
            messagingSenderId: "1016556488732",
            appId: "1:1016556488732:web:06bf11f1be63a4242d77d9",
            
            // Firebase í™œì„±í™”
            disabled: false // ì‹¤ì œ Firebase í”„ë¡œì íŠ¸ ì—°ê²°ë¨
        };

        // Firebase ì´ˆê¸°í™” (ì¡°ê±´ë¶€)
        let firebaseEnabled = false;
        
        if (!firebaseConfig.disabled && firebaseConfig.apiKey !== "AIzaSyDQGQGQGQGQGQGQGQGQGQGQGQGQGQGQG") {
            try {
                const app = initializeApp(firebaseConfig);
                const storage = getStorage(app);
                const firestore = getFirestore(app);

                // ì „ì—­ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •
                window.firebaseStorage = storage;
                window.firebaseFirestore = firestore;
                window.firebaseModules = {
                    ref, uploadBytes, getDownloadURL, deleteObject,
                    collection, addDoc, doc, deleteDoc, serverTimestamp
                };
                
                firebaseEnabled = true;
                console.log("ğŸ”¥ Firebase v11.6.0 ì´ˆê¸°í™” ì™„ë£Œ (í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ)");
            } catch (error) {
                console.warn("âš ï¸ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨, ë¡œì»¬ ì „ìš© ëª¨ë“œë¡œ ì „í™˜:", error.message);
                firebaseEnabled = false;
            }
        } else {
            console.log("ğŸ“± ë¡œì»¬ ì „ìš© ëª¨ë“œ (Firebase ë¹„í™œì„±í™”)");
            firebaseEnabled = false;
        }
        
        // Firebase ìƒíƒœë¥¼ ì „ì—­ì— ì €ì¥
        window.firebaseEnabled = firebaseEnabled;
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-title {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .landlord-section .section-title {
            background: linear-gradient(135deg, #3742fa, #2f3542);
        }
        
        .tenant-section .section-title {
            background: linear-gradient(135deg, #5f27cd, #341f97);
        }
        
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .priority-stars {
            color: #ffc107;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .task-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .image-container {
            position: relative;
            min-height: 200px;
            background: #f8f9fa;
        }
        
        .carousel-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }
        
        .carousel-track {
            display: flex;
            transition: transform 0.3s ease;
            height: 100%;
        }
        
        .carousel-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        
        .carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .carousel-image:hover {
            transform: scale(1.02);
        }
        
        /* ğŸ†• ì €ì¥ ìƒíƒœ ì•„ì´ì½˜ */
        .storage-status {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            z-index: 10;
        }
        
        .status-local {
            background: rgba(255, 152, 0, 0.9);
        }
        
        .status-cloud {
            background: rgba(76, 175, 80, 0.9);
        }
        
        .status-syncing {
            background: rgba(33, 150, 243, 0.9);
        }
        
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .carousel-nav:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .carousel-nav.prev {
            left: 10px;
        }
        
        .carousel-nav.next {
            right: 10px;
        }
        
        .no-image {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #999;
            font-size: 14px;
        }
        
        .image-controls {
            padding: 15px 20px;
            background: #f8f9fa;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        /* ğŸ†• ë™ê¸°í™” ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-sync {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            font-weight: bold;
        }
        
        .btn-sync:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
        }
        
        .btn-sync:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .image-counter {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
        }
        
        .delete-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .delete-btn:hover {
            background: rgba(220, 53, 69, 1);
        }
        
        .data-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .data-controls h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        /* ğŸ†• ë™ê¸°í™” ìƒíƒœ í‘œì‹œ */
        .sync-status {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }
        
        .sync-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .sync-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .sync-status.syncing {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .lightbox {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
        }
        
        .lightbox-content {
            position: relative;
            margin: auto;
            display: block;
            width: 90%;
            max-width: 900px;
            max-height: 80%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .lightbox img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .lightbox-close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .lightbox-close:hover {
            color: #bbb;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 20px 15px;
            cursor: pointer;
            font-size: 24px;
        }
        
        .lightbox-nav:hover {
            background: rgba(0, 0, 0, 0.8);
        }
        
        .lightbox-nav.prev {
            left: 20px;
        }
        
        .lightbox-nav.next {
            right: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }
            
            .image-controls {
                justify-content: center;
            }
            
            .data-controls {
                padding: 15px;
            }
            
            .data-controls .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ë¶€ì•”ë™ ê±´ì¶• ì ê²€ ë³´ê³ ì„œ</h1>
        
        <!-- ğŸ†• í–¥ìƒëœ ë°ì´í„° ê´€ë¦¬ ì»¨íŠ¸ë¡¤ -->
        <div class="data-controls">
            <h3>ğŸ“± ë°ì´í„° ê´€ë¦¬ (í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ)</h3>
            
            <!-- ğŸ†• ë™ê¸°í™” ìƒíƒœ í‘œì‹œ -->
            <div id="sync-status" class="sync-status disconnected">
                ğŸ”„ Firebase ì—°ê²° ì¤‘...
            </div>
            
            <!-- ğŸ†• í´ë¼ìš°ë“œ ë™ê¸°í™” ë²„íŠ¼ -->
            <div style="margin-bottom: 15px;">
                <button class="btn btn-sync" id="sync-button" onclick="syncAllToCloud()">
                    â˜ï¸ ë¡œì»¬ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œì— ë™ê¸°í™”
                </button>
                <button class="btn btn-secondary" onclick="checkSyncStatus()">
                    ğŸ” ë™ê¸°í™” ìƒíƒœ í™•ì¸
                </button>
            </div>
            
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="exportData()">ğŸ’¾ ë°ì´í„° ë°±ì—…</button>
                <button class="btn btn-primary" onclick="importData()">ğŸ“¥ ë°ì´í„° ë³µì›</button>
                <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
            </div>
            
            <div style="margin-top: 15px; font-size: 12px; color: #666;">
                <strong>ğŸ“± = ë¡œì»¬ ì €ì¥</strong> | <strong>â˜ï¸ = í´ë¼ìš°ë“œ ì €ì¥</strong> | <strong>ğŸ”„ = ë™ê¸°í™” ì¤‘</strong><br>
                * ì‚¬ì§„ì€ ë¸Œë¼ìš°ì €(LocalStorage) + Firebase Storageì— ì´ì¤‘ ì €ì¥ë©ë‹ˆë‹¤.<br>
                * ì˜¤í”„ë¼ì¸ì—ì„œë„ ì‘ë™í•˜ë©°, ì˜¨ë¼ì¸ì‹œ ìë™ìœ¼ë¡œ í´ë¼ìš°ë“œ ë°±ì—…ë©ë‹ˆë‹¤.
            </div>
        </div>        
        <!-- ì„ëŒ€ì¸ í˜‘ì˜ì‚¬í•­ -->
        <div class="section landlord-section">
            <div class="section-title">ğŸ‘¥ ì„ëŒ€ì¸ í˜‘ì˜ì‚¬í•­ (13ê°œ)</div>
            <div class="cards-grid">
                <!-- 1ë²ˆ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">
                        <div class="priority-stars">â­â­â­â­â­</div>
                        <h3 class="task-title">1ë²ˆ ê±´ë¬¼ì™¸ë²½ ê³°íŒ¡ì´ ì²­ì†Œ</h3>
                    </div>
                    <div class="image-container">
                        <div id="carousel-1" class="carousel-container">
                            <div class="carousel-track">
                                <div class="carousel-slide">
                                    <div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <button class="carousel-nav prev" onclick="prevImage('1')" style="display: none;">â€¹</button>
                        <button class="carousel-nav next" onclick="nextImage('1')" style="display: none;">â€º</button>
                    </div>
                    <div class="image-controls">
                        <div>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input-1').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('camera-input-1').click()">ğŸ“¸ ì¹´ë©”ë¼</button>
                            <input type="file" id="file-input-1" class="file-input" accept="image/*" onchange="handleImageUpload(event, '1')">
                            <input type="file" id="camera-input-1" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '1')">
                        </div>
                        <div class="image-counter" id="counter-1">0/0</div>
                    </div>
                </div>

                <!-- 2ë²ˆ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">
                        <div class="priority-stars">â­â­â­â­â­</div>
                        <h3 class="task-title">2ë²ˆ ê³„ë‹¨ ë‚œê°„ ì†ì¡ì´ ì„¤ì¹˜</h3>
                    </div>
                    <div class="image-container">
                        <div id="carousel-2" class="carousel-container">
                            <div class="carousel-track">
                                <div class="carousel-slide">
                                    <div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <button class="carousel-nav prev" onclick="prevImage('2')" style="display: none;">â€¹</button>
                        <button class="carousel-nav next" onclick="nextImage('2')" style="display: none;">â€º</button>
                    </div>
                    <div class="image-controls">
                        <div>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input-2').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('camera-input-2').click()">ğŸ“¸ ì¹´ë©”ë¼</button>
                            <input type="file" id="file-input-2" class="file-input" accept="image/*" onchange="handleImageUpload(event, '2')">
                            <input type="file" id="camera-input-2" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '2')">
                        </div>
                        <div class="image-counter" id="counter-2">0/0</div>
                    </div>
                </div>

                <!-- 3ë²ˆ ì¹´ë“œ -->
                <div class="card">
                    <div class="card-header">
                        <div class="priority-stars">â­â­â­â­â­</div>
                        <h3 class="task-title">3ë²ˆ 2ì¸µ í™”ì¥ì‹¤ ì²œì¥ ëˆ„ìˆ˜</h3>
                    </div>
                    <div class="image-container">
                        <div id="carousel-3" class="carousel-container">
                            <div class="carousel-track">
                                <div class="carousel-slide">
                                    <div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <button class="carousel-nav prev" onclick="prevImage('3')" style="display: none;">â€¹</button>
                        <button class="carousel-nav next" onclick="nextImage('3')" style="display: none;">â€º</button>
                    </div>
                    <div class="image-controls">
                        <div>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input-3').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('camera-input-3').click()">ğŸ“¸ ì¹´ë©”ë¼</button>
                            <input type="file" id="file-input-3" class="file-input" accept="image/*" onchange="handleImageUpload(event, '3')">
                            <input type="file" id="camera-input-3" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '3')">
                        </div>
                        <div class="image-counter" id="counter-3">0/0</div>
                    </div>
                </div>
                <!-- 4-14ë²ˆ ì¹´ë“œë“¤ -->
                <div class="card">
                    <div class="card-header">
                        <div class="priority-stars">â­â­â­â­â­</div>
                        <h3 class="task-title">4ë²ˆ 1ì¸µ ë°”ë‹¥ ë³´ìˆ˜</h3>
                    </div>
                    <div class="image-container">
                        <div id="carousel-4" class="carousel-container">
                            <div class="carousel-track">
                                <div class="carousel-slide">
                                    <div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <button class="carousel-nav prev" onclick="prevImage('4')" style="display: none;">â€¹</button>
                        <button class="carousel-nav next" onclick="nextImage('4')" style="display: none;">â€º</button>
                    </div>
                    <div class="image-controls">
                        <div>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input-4').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('camera-input-4').click()">ğŸ“¸ ì¹´ë©”ë¼</button>
                            <input type="file" id="file-input-4" class="file-input" accept="image/*" onchange="handleImageUpload(event, '4')">
                            <input type="file" id="camera-input-4" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '4')">
                        </div>
                        <div class="image-counter" id="counter-4">0/0</div>
                    </div>
                </div>

                <!-- ë‚˜ë¨¸ì§€ ì¹´ë“œë“¤ 5-13ë²ˆ (ê°„ì†Œí™”) -->
                <div class="card"><div class="card-header"><div class="priority-stars">â­â­â­â­â­</div><h3 class="task-title">5ë²ˆ 2ì¸µ ë°”ë‹¥ ë³´ìˆ˜</h3></div><div class="image-container"><div id="carousel-5" class="carousel-container"><div class="carousel-track"><div class="carousel-slide"><div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div></div></div></div><button class="carousel-nav prev" onclick="prevImage('5')" style="display: none;">â€¹</button><button class="carousel-nav next" onclick="nextImage('5')" style="display: none;">â€º</button></div><div class="image-controls"><div><button class="btn btn-primary" onclick="document.getElementById('file-input-5').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button><button class="btn btn-secondary" onclick="document.getElementById('camera-input-5').click()">ğŸ“¸ ì¹´ë©”ë¼</button><input type="file" id="file-input-5" class="file-input" accept="image/*" onchange="handleImageUpload(event, '5')"><input type="file" id="camera-input-5" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '5')"></div><div class="image-counter" id="counter-5">0/0</div></div></div>

                <div class="card"><div class="card-header"><div class="priority-stars">â­â­â­â­</div><h3 class="task-title">6ë²ˆ 4ì¸µ í™”ì¥ì‹¤ ë°”ë‹¥ ëˆ„ìˆ˜</h3></div><div class="image-container"><div id="carousel-6" class="carousel-container"><div class="carousel-track"><div class="carousel-slide"><div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div></div></div></div><button class="carousel-nav prev" onclick="prevImage('6')" style="display: none;">â€¹</button><button class="carousel-nav next" onclick="nextImage('6')" style="display: none;">â€º</button></div><div class="image-controls"><div><button class="btn btn-primary" onclick="document.getElementById('file-input-6').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button><button class="btn btn-secondary" onclick="document.getElementById('camera-input-6').click()">ğŸ“¸ ì¹´ë©”ë¼</button><input type="file" id="file-input-6" class="file-input" accept="image/*" onchange="handleImageUpload(event, '6')"><input type="file" id="camera-input-6" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '6')"></div><div class="image-counter" id="counter-6">0/0</div></div></div>

                <div class="card"><div class="card-header"><div class="priority-stars">â­â­â­â­</div><h3 class="task-title">7ë²ˆ ì¡°ê²½ ì •ë¦¬</h3></div><div class="image-container"><div id="carousel-7" class="carousel-container"><div class="carousel-track"><div class="carousel-slide"><div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div></div></div></div><button class="carousel-nav prev" onclick="prevImage('7')" style="display: none;">â€¹</button><button class="carousel-nav next" onclick="nextImage('7')" style="display: none;">â€º</button></div><div class="image-controls"><div><button class="btn btn-primary" onclick="document.getElementById('file-input-7').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button><button class="btn btn-secondary" onclick="document.getElementById('camera-input-7').click()">ğŸ“¸ ì¹´ë©”ë¼</button><input type="file" id="file-input-7" class="file-input" accept="image/*" onchange="handleImageUpload(event, '7')"><input type="file" id="camera-input-7" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '7')"></div><div class="image-counter" id="counter-7">0/0</div></div></div>
            </div>
        </div>

        <!-- ì „ì„ì°¨ì¸ í˜‘ì˜ì‚¬í•­ -->
        <div class="section tenant-section">
            <div class="section-title">ğŸª ì „ì„ì°¨ì¸ í˜‘ì˜ì‚¬í•­ (1ê°œ)</div>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="priority-stars">â­</div>
                        <h3 class="task-title">14ë²ˆ ì¹´í˜ ë°”í…Œì´ë¸” ì²˜ë¦¬</h3>
                    </div>
                    <div class="image-container">
                        <div id="carousel-14" class="carousel-container">
                            <div class="carousel-track">
                                <div class="carousel-slide">
                                    <div class="no-image">ğŸ“· í˜„ì¥ ì‚¬ì§„ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”</div>
                                </div>
                            </div>
                        </div>
                        <button class="carousel-nav prev" onclick="prevImage('14')" style="display: none;">â€¹</button>
                        <button class="carousel-nav next" onclick="nextImage('14')" style="display: none;">â€º</button>
                    </div>
                    <div class="image-controls">
                        <div>
                            <button class="btn btn-primary" onclick="document.getElementById('file-input-14').click()">ğŸ“· ì‚¬ì§„ ì¶”ê°€</button>
                            <button class="btn btn-secondary" onclick="document.getElementById('camera-input-14').click()">ğŸ“¸ ì¹´ë©”ë¼</button>
                            <input type="file" id="file-input-14" class="file-input" accept="image/*" onchange="handleImageUpload(event, '14')">
                            <input type="file" id="camera-input-14" class="file-input" accept="image/*" capture="environment" onchange="handleImageUpload(event, '14')">
                        </div>
                        <div class="image-counter" id="counter-14">0/0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Lightbox -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <span class="lightbox-close">&times;</span>
        <button class="lightbox-nav prev" onclick="event.stopPropagation(); prevLightboxImage()">â€¹</button>
        <button class="lightbox-nav next" onclick="event.stopPropagation(); nextLightboxImage()">â€º</button>
        <div class="lightbox-content">
            <img id="lightbox-image" src="" alt="">
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let allCarousels = {};
        let currentCarousel = null;
        let currentImageIndex = 0;
        let lightboxImages = [];
        let currentLightboxIndex = 0;

        // ğŸ†• ë™ê¸°í™” ìƒíƒœ ê´€ë¦¬
        let syncStatus = {
            connected: false,
            syncing: false,
            lastSync: null
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            updateFirebaseStatus();
            loadInitialImages();
            initializeCarousels();
            checkStorageQuota();
            
            // ğŸ†• ë™ê¸°í™” ìƒíƒœ ì²´í¬
            setTimeout(checkSyncStatus, 2000);
        }

        function updateFirebaseStatus() {
            const statusElement = document.getElementById('sync-status');
            const syncButton = document.getElementById('sync-button');
            
            if (window.firebaseEnabled) {
                statusElement.innerHTML = 'â˜ï¸ Firebase ì—°ê²°ë¨ - í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ í™œì„±';
                statusElement.className = 'sync-status connected';
                syncButton.disabled = false;
                syncStatus.connected = true;
            } else {
                statusElement.innerHTML = 'ğŸ“± ë¡œì»¬ ì „ìš© ëª¨ë“œ - Firebase ì—°ê²° ì‹¤íŒ¨';
                statusElement.className = 'sync-status disconnected';
                syncButton.disabled = true;
                syncStatus.connected = false;
            }
        }

        // ğŸ†• í´ë¼ìš°ë“œ ë™ê¸°í™” í•¨ìˆ˜
        async function syncAllToCloud() {
            if (!window.firebaseEnabled) {
                alert('âš ï¸ Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            const syncButton = document.getElementById('sync-button');
            const statusElement = document.getElementById('sync-status');
            
            syncButton.disabled = true;
            syncButton.innerHTML = 'ğŸ”„ ë™ê¸°í™” ì¤‘...';
            statusElement.innerHTML = 'ğŸ”„ í´ë¼ìš°ë“œ ë™ê¸°í™” ì§„í–‰ ì¤‘...';
            statusElement.className = 'sync-status syncing';
            syncStatus.syncing = true;

            try {
                let syncCount = 0;
                
                // ëª¨ë“  ì¹´ë“œì˜ ì´ë¯¸ì§€ ë™ê¸°í™”
                for (let cardId = 1; cardId <= 14; cardId++) {
                    const images = JSON.parse(localStorage.getItem(`carousel-images-${cardId}`) || '[]');
                    
                    for (let i = 0; i < images.length; i++) {
                        const imageData = images[i];
                        
                        // ë¡œì»¬ì—ë§Œ ìˆëŠ” ì´ë¯¸ì§€ ì°¾ê¸° (firebaseUrlì´ ì—†ëŠ” ê²½ìš°)
                        if (!imageData.firebaseUrl && imageData.dataUrl) {
                            try {
                                const firebaseUrl = await uploadToFirebase(imageData.dataUrl, `card-${cardId}-${Date.now()}-${i}.jpg`);
                                imageData.firebaseUrl = firebaseUrl;
                                imageData.synced = true;
                                syncCount++;
                                
                                console.log(`âœ… ì¹´ë“œ ${cardId} ì´ë¯¸ì§€ ${i+1} ë™ê¸°í™” ì™„ë£Œ`);
                            } catch (error) {
                                console.error(`âŒ ì¹´ë“œ ${cardId} ì´ë¯¸ì§€ ${i+1} ë™ê¸°í™” ì‹¤íŒ¨:`, error);
                            }
                        }
                    }
                    
                    // ì—…ë°ì´íŠ¸ëœ ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥
                    localStorage.setItem(`carousel-images-${cardId}`, JSON.stringify(images));
                    updateStorageStatus(cardId);
                }

                syncStatus.lastSync = new Date().toLocaleString();
                statusElement.innerHTML = `â˜ï¸ ë™ê¸°í™” ì™„ë£Œ (${syncCount}ê°œ ì´ë¯¸ì§€) - ${syncStatus.lastSync}`;
                statusElement.className = 'sync-status connected';
                
                // ëª¨ë“  ì¹´ë“œì˜ ì €ì¥ ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                for (let cardId = 1; cardId <= 14; cardId++) {
                    updateStorageStatus(cardId);
                }

            } catch (error) {
                console.error('ë™ê¸°í™” ì‹¤íŒ¨:', error);
                statusElement.innerHTML = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨ - ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
                statusElement.className = 'sync-status disconnected';
            } finally {
                syncButton.disabled = false;
                syncButton.innerHTML = 'â˜ï¸ ë¡œì»¬ ë°ì´í„°ë¥¼ í´ë¼ìš°ë“œì— ë™ê¸°í™”';
                syncStatus.syncing = false;
            }
        }
        // ğŸ†• ë™ê¸°í™” ìƒíƒœ í™•ì¸
        async function checkSyncStatus() {
            const statusElement = document.getElementById('sync-status');
            
            if (!window.firebaseEnabled) {
                alert('ğŸ“± í˜„ì¬ ë¡œì»¬ ì „ìš© ëª¨ë“œì…ë‹ˆë‹¤.\n\nëª¨ë“  ì´ë¯¸ì§€ê°€ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            let totalImages = 0;
            let syncedImages = 0;
            let localOnlyImages = 0;

            for (let cardId = 1; cardId <= 14; cardId++) {
                const images = JSON.parse(localStorage.getItem(`carousel-images-${cardId}`) || '[]');
                totalImages += images.length;
                
                images.forEach(img => {
                    if (img.firebaseUrl) {
                        syncedImages++;
                    } else {
                        localOnlyImages++;
                    }
                });
            }

            const message = `ğŸ“Š ë™ê¸°í™” ìƒíƒœ í™•ì¸ ê²°ê³¼:\n\n` +
                           `â€¢ ì „ì²´ ì´ë¯¸ì§€: ${totalImages}ê°œ\n` +
                           `â€¢ â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”: ${syncedImages}ê°œ\n` +
                           `â€¢ ğŸ“± ë¡œì»¬ ì „ìš©: ${localOnlyImages}ê°œ\n\n` +
                           `${localOnlyImages > 0 ? 'ğŸ’¡ "í´ë¼ìš°ë“œ ë™ê¸°í™”" ë²„íŠ¼ìœ¼ë¡œ ë¡œì»¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”!' : 'âœ… ëª¨ë“  ì´ë¯¸ì§€ê°€ ë™ê¸°í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤!'}`;
            
            alert(message);
        }

        // ğŸ†• ì €ì¥ ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        function updateStorageStatus(cardId) {
            const carousel = document.getElementById(`carousel-${cardId}`);
            const images = JSON.parse(localStorage.getItem(`carousel-images-${cardId}`) || '[]');
            
            // ê¸°ì¡´ ìƒíƒœ ì•„ì´ì½˜ ì œê±°
            const existingStatus = carousel.querySelectorAll('.storage-status');
            existingStatus.forEach(status => status.remove());
            
            // í˜„ì¬ í‘œì‹œëœ ì´ë¯¸ì§€ì˜ ìƒíƒœ í™•ì¸
            const currentIndex = allCarousels[cardId]?.currentIndex || 0;
            if (images.length > 0 && images[currentIndex]) {
                const currentImage = images[currentIndex];
                const imageElement = carousel.querySelector('.carousel-slide img');
                
                if (imageElement) {
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'storage-status';
                    
                    if (syncStatus.syncing) {
                        statusDiv.className += ' status-syncing';
                        statusDiv.innerHTML = 'ğŸ”„ ë™ê¸°í™”ì¤‘';
                    } else if (currentImage.firebaseUrl) {
                        statusDiv.className += ' status-cloud';
                        statusDiv.innerHTML = 'â˜ï¸ í´ë¼ìš°ë“œ';
                    } else {
                        statusDiv.className += ' status-local';
                        statusDiv.innerHTML = 'ğŸ“± ë¡œì»¬';
                    }
                    
                    imageElement.parentElement.appendChild(statusDiv);
                }
            }
        }

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬ (ê°œì„ ë¨)
        async function handleImageUpload(event, cardId) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB ì œí•œ)
                if (file.size > 10 * 1024 * 1024) {
                    alert('âš ï¸ íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                    return;
                }

                console.log(`ğŸ“· ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œì‘: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)}MB)`);

                // ì´ë¯¸ì§€ ì••ì¶•
                const compressedDataUrl = await compressImage(file);
                console.log(`ğŸ—œï¸ ì••ì¶• ì™„ë£Œ: ${((compressedDataUrl.length * 0.75) / 1024 / 1024).toFixed(2)}MB`);

                // ìƒˆ ì´ë¯¸ì§€ ë°ì´í„° ìƒì„±
                const newImageData = {
                    dataUrl: compressedDataUrl,
                    filename: file.name,
                    timestamp: Date.now(),
                    size: compressedDataUrl.length,
                    compressed: true,
                    synced: false
                };

                // Firebase Storageì— ì—…ë¡œë“œ ì‹œë„ (í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ)
                if (window.firebaseEnabled) {
                    try {
                        const firebaseUrl = await uploadToFirebase(compressedDataUrl, `card-${cardId}-${Date.now()}.jpg`);
                        newImageData.firebaseUrl = firebaseUrl;
                        newImageData.synced = true;
                        console.log('â˜ï¸ Firebase Storage ì—…ë¡œë“œ ì„±ê³µ');
                    } catch (error) {
                        console.warn('âš ï¸ Firebase ì—…ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ ì €ì¥ë§Œ ì§„í–‰:', error.message);
                    }
                }

                // LocalStorageì— ì €ì¥
                addImageToCarousel(cardId, newImageData);
                
                // ì €ì¥ ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
                setTimeout(() => updateStorageStatus(cardId), 100);

                // ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ì²´í¬
                checkStorageQuota();

            } catch (error) {
                console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }

            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }
        // Firebase Storage ì—…ë¡œë“œ í•¨ìˆ˜
        async function uploadToFirebase(dataUrl, filename) {
            if (!window.firebaseEnabled) {
                throw new Error('Firebaseê°€ í™œì„±í™”ë˜ì§€ ì•ŠìŒ');
            }

            try {
                const response = await fetch(dataUrl);
                const blob = await response.blob();
                
                const { ref, uploadBytes, getDownloadURL } = window.firebaseModules;
                const storageRef = ref(window.firebaseStorage, `images/${filename}`);
                
                const snapshot = await uploadBytes(storageRef, blob);
                const downloadURL = await getDownloadURL(snapshot.ref);
                
                return downloadURL;
            } catch (error) {
                console.error('Firebase ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                    canvas.width = img.width * ratio;
                    canvas.height = img.height * ratio;
                    
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    resolve(compressedDataUrl);
                };
                
                img.onerror = reject;
                img.src = URL.createObjectURL(file);
            });
        }

        // ìºëŸ¬ì…€ì— ì´ë¯¸ì§€ ì¶”ê°€
        function addImageToCarousel(cardId, newImageData) {
            try {
                const images = JSON.parse(localStorage.getItem(`carousel-images-${cardId}`) || '[]');
                images.push(newImageData);
                localStorage.setItem(`carousel-images-${cardId}`, JSON.stringify(images));

                if (!allCarousels[cardId]) {
                    allCarousels[cardId] = { images: [], currentIndex: 0 };
                }
                allCarousels[cardId].images = images;

                renderCarousel(cardId);
                updateImageCounter(cardId);

                console.log(`âœ… ì¹´ë“œ ${cardId}ì— ì´ë¯¸ì§€ ì¶”ê°€ë¨ (ì´ ${images.length}ê°œ)`);

            } catch (error) {
                if (error.name === 'QuotaExceededError') {
                    handleStorageQuotaExceeded(cardId);
                } else {
                    throw error;
                }
            }
        }

        // ìºëŸ¬ì…€ ë Œë”ë§
        function renderCarousel(cardId) {
            const carousel = allCarousels[cardId];
            if (!carousel || carousel.images.length === 0) {
                return;
            }

            const carouselContainer = document.getElementById(`carousel-${cardId}`);
            const track = carouselContainer.querySelector('.carousel-track');
            
            track.innerHTML = '';

            carousel.images.forEach((imageData, index) => {
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                
                const img = document.createElement('img');
                img.src = imageData.dataUrl;
                img.className = 'carousel-image';
                img.onclick = () => openLightbox(cardId, index);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = 'Ã—';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteImage(cardId, index);
                };
                
                slide.appendChild(img);
                slide.appendChild(deleteBtn);
                track.appendChild(slide);
            });

            updateCarouselPosition(cardId);
            
            const prevBtn = carouselContainer.parentElement.querySelector('.carousel-nav.prev');
            const nextBtn = carouselContainer.parentElement.querySelector('.carousel-nav.next');
            
            if (carousel.images.length > 1) {
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
            } else {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
            }

            // ì €ì¥ ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
            setTimeout(() => updateStorageStatus(cardId), 100);
        }

        // ìºëŸ¬ì…€ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        function updateCarouselPosition(cardId) {
            const carousel = allCarousels[cardId];
            if (!carousel) return;

            const track = document.querySelector(`#carousel-${cardId} .carousel-track`);
            const translateX = -carousel.currentIndex * 100;
            track.style.transform = `translateX(${translateX}%)`;
        }

        // ì´ë¯¸ì§€ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
        function updateImageCounter(cardId) {
            const counter = document.getElementById(`counter-${cardId}`);
            const carousel = allCarousels[cardId];
            
            if (carousel && carousel.images.length > 0) {
                counter.textContent = `${carousel.currentIndex + 1}/${carousel.images.length}`;
            } else {
                counter.textContent = '0/0';
            }
        }